<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>High Availability Guide</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta content="Scroll Wiki Publisher" name="generator"/>
    <link rel="stylesheet" href="css/content-style.css" type="text/css"/>
</head>
<body>
    <div class="container">
        <div id="title" class="prepend-top">
              <img src="spacelogo.png" />        
            <h1>WildFly 8</h1>
              <h1>High Availability Guide</h1>
            <p>Exported from <a href="https://docs.jboss.org/author/display/WFLY8">JBoss Community Documentation Editor</a> at 2014-12-31 09:06:42 EST.</p>
            <p>Copyright 2014 JBoss Community contributors.</p>
            <br/><br/>
        </div>
        
        <div id="66322833" class="content prepend-top">
<ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-IntroductiontoHighAvailabilityServices">Introduction to High Availability Services</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-WhatareHighAvailabilityservices%3F">What are High Availability services?</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-HighAvailabilitythroughfailover">High Availability through fail-over</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-HighAvailabilitythroughloadbalancing">High Availability through load balancing</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Aimsoftheguide">Aims of the guide</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Organizationoftheguide">Organization of the guide</a>            </p>
    </li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-HTTPServices">HTTP Services</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-SubsystemSupport">Subsystem Support</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-JGroupsSubsystem">JGroups Subsystem</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Purpose">Purpose</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Configurationexample">Configuration example</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Csubsystem%3E">&lt;subsystem&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Cstack%3E">&lt;stack&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Ctransport%3E">&lt;transport&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Cprotocol%3E">&lt;protocol&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Crelay%3E">&lt;relay&gt;</a>            </p>
    </li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-UseCases">Use Cases</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Addastack">Add a stack</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Addaprotocoltoastack">Add a protocol to a stack</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Addapropertytoaprotocol">Add a property to a protocol</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-InfinispanSubsystem">Infinispan Subsystem</a>            </p>
    </li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Purpose">Purpose</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-ConfigurationExample">Configuration Example</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Ccachecontainer%3E">&lt;cache-container&gt;</a>            </p>
    </li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-UseCases">Use Cases</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Addacachecontainer">Add a cache container</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Addacache">Add a cache</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Configurethetransactioncomponentofacache">Configure the transaction component of a cache</a>            </p>
    </li></ul></li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-ClusteredWebSessions">Clustered Web Sessions</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-ClusteredSSO">Clustered SSO</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-LoadBalancing">Load Balancing</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-LoadbalancingwithApachemodjk">Load balancing with Apache + mod_jk</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-LoadbalancingwithApachemodcluster">Load balancing with Apache + mod_cluster</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-modclusterSubsystem">mod_cluster Subsystem</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Configuration">Configuration</a>            </p>
    </li></ul></li></ul></li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-EJBServices">EJB Services</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-EJBSubsystem">EJB Subsystem</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-MarkinganEJBasclustered">Marking an EJB as clustered</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-DeployingclusteredEJBs">Deploying clustered EJBs</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-FailoverforclusteredEJBs">Failover for clustered EJBs</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Remotestandaloneclients">Remote standalone clients</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Clustertopologycommunication">Cluster topology communication</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-RemoteclientsonanotherinstanceofWildFly8">Remote clients on another instance of WildFly 8</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Testcasesforfailoverofstatefulbeans">Testcases for failover of stateful beans</a>            </p>
    </li></ul></li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Hibernate">Hibernate</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-RelatedIssues">Related Issues</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-ModularityAndClassLoading">Modularity And Class Loading</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Monitoring">Monitoring</a>            </p>
    </li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-ChangesFromPreviousVersions">Changes From Previous Versions</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Keychanges">Key changes</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-MigrationtoWildfly">Migration to Wildfly</a>            </p>
    </li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-WildFly8DomainClusterHowto">WildFly 8 Domain Cluster Howto</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Preparation%26Scenario">Preparation &amp; Scenario</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Preparation">Preparation</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Scenario">Scenario</a>            </p>
    </li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-DownloadWildFly8">Download WildFly 8</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-DomainConfiguration">Domain Configuration</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Interfaceconfigonmaster">Interface config on master</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Interfaceconfigonslave">Interface config on slave</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-SecurityConfiguration">Security Configuration</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Master">Master</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Slave">Slave</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-DryRun">Dry Run</a>            </p>
    </li></ul></li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Deployment">Deployment</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-ClusterConfiguration">Cluster Configuration</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Testing">Testing</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-SpecialThanks">Special Thanks</a>            </p>
    </li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-WildFly8LBHAStandaloneClusterHowto">WildFly 8 LB HA Standalone Cluster Howto</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-PreparationandScenario">Preparation and Scenario</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Scenario">Scenario</a>            </p>
    </li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-DownloadWildFly8">Download WildFly 8</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-StartingWildflyinClusterConfiguration">Starting Wildfly in Cluster Configuration</a>            </p>
    </li></ul></li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Installing%26ConfiguringApacheHttpd">Installing &amp; Configuring Apache Httpd</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-DownloadApachehttpd">Download Apache httpd</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Configuration">Configuration</a>            </p>
    </li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-References">References</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-AllWildFly8documentation">All WildFly 8 documentation</a>            </p>
    </li></ul>    <div class="section-2"  id="66322833_HighAvailabilityGuide-IntroductiontoHighAvailabilityServices"  >
        <h2>Introduction to High Availability Services</h2>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-WhatareHighAvailabilityservices%3F"  >
        <h3>What are High Availability services?</h3>
    
            <p>
    WildFly's&nbsp;High Availability services are used to guarantee availability of a deployed Java EE&nbsp;application.            </p>
                <p>
    Deploying critical applications on a single node suffers from two potential problems:            </p>
    <ul class=" "><li class=" ">            <p>
    loss of application availability when the node hosting the application crashes (single point of failure)            </p>
    </li><li class=" ">            <p>
    loss of application availability in the form of extreme delays in response time during high volumes of requests (overwhelmed server)            </p>
    </li></ul>            <p>
    WildFly&nbsp;supports two features which ensure high availability of critical Java EE applications:            </p>
    <ul class=" "><li class=" ">            <p>
    <strong class=" ">fail-over:</strong>&nbsp;allows a client interacting with a Java EE&nbsp;application to have uninterrupted access to that application, even in the presence of node failures            </p>
    </li><li class=" ">            <p>
    <strong class=" ">load balancing:</strong>&nbsp;allows a client to have timely responses from the application, even in the presence of high-volumes of requests            </p>
    </li></ul>    <div class="confbox admonition admonition-note">
        
            <p>
    These two independent high availability services can very effectively inter-operate when making use of mod_cluster for load balancing! &nbsp;            </p>
        </div>
    
            <p>
    Taking advantage of WildFly's&nbsp;high availability services is easy, and simply involves deploying WildFly&nbsp;on a cluster of nodes, making a small number of application configuration changes, and then deploying the application in the cluster.            </p>
                <p>
    We now take a brief look at what these services can guarantee.&nbsp;            </p>
        </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-HighAvailabilitythroughfailover"  >
        <h3>High Availability through fail-over</h3>
    
            <p>
    Fail-over allows a client&nbsp;interacting with a Java EE&nbsp;application to have uninterrupted access to that application, even in the presence of node failures.&nbsp;For example, consider a Java EE&nbsp;application which makes use of the following features:            </p>
    <ul class=" "><li class=" ">            <p>
    &nbsp; session-oriented servlets to provide user interaction            </p>
    </li><li class=" ">            <p>
    &nbsp; session-oriented EJBs to perform state-dependent business computation &nbsp;            </p>
    </li><li class=" ">            <p>
    &nbsp; EJB entity beans to store critical data in a persistent store (e.g. database)            </p>
    </li><li class=" ">            <p>
    &nbsp; SSO login to the application            </p>
    </li></ul>            <p>
    If the application makes use of WildFly's fail-over services, a client interacting with an instance of that application will not be interrupted even when the node on which that instance executes crashes. Behind the scenes, WildFly&nbsp;makes sure that all of the user data that the application make use of (HTTP session data, EJB SFSB sessions, EJB entities and SSO credentials) are available at other nodes in the cluster, so that when a failure occurs and the client is redirected to that new node for continuation of processing (i.e. the client &quot;fails over&quot; to the new node), the user's data is available and processing can continue.            </p>
                <p>
    The Infinispan and JGroups subsystems are instrumental in providing these data availability guarantees and will be discussed in detail later in the guide.&nbsp;            </p>
        </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-HighAvailabilitythroughloadbalancing"  >
        <h3>High Availability through load balancing</h3>
    
            <p>
    Load balancing enables the application to respond to client requests in a timely fashion, even when subjected to a high-volume of requests. Using a load balancer as a front-end, each incoming HTTP request can be directed to one node in the cluster for processing.&nbsp; In this way, the cluster acts as a pool of processing nodes and the load is &quot;balanced&quot; over the pool, achieving scalability and, as a consequence, availability.&nbsp; Requests involving session-oriented servlets are directed to the the same application instance in the pool for efficiency of processing (sticky sessions). Using mod_cluster has the advantage that changes in cluster topology (scaling the pool up or down, servers crashing) are communicated back to the load balancer and used to update in real time the load balancing activity and avoid requests being directed to application instances which are no longer available.&nbsp;            </p>
                <p>
    The mod_cluster subsystem is instrumental in providing support for this High Availability feature of WildFly&nbsp;and will be discussed in detail later in this guide.&nbsp;            </p>
        </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-Aimsoftheguide"  >
        <h3>Aims of the guide</h3>
    
            <p>
    This guide aims to:            </p>
    <ul class=" "><li class=" ">            <p>
    provide a description of the high-availability features available in WildFly&nbsp;and the services they depend on            </p>
    </li><li class=" ">            <p>
    show how the various high availability services can be configured for particular application use cases            </p>
    </li><li class=" ">            <p>
    identify default behavior for features relating to high-availability/clustering            </p>
    </li></ul>    </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-Organizationoftheguide"  >
        <h3>Organization of the guide</h3>
    
            <p>
    As high availability features and their configuration depend on the particular component they affect (e.g. HTTP sessions, EJB SFSB sessions, Hibernate), we organize the discussion around those Java EE&nbsp;features. We strive to make each section as self-contained as possible. Also, when discussing a feature, we will introduce any WildFly&nbsp;subsystems upon which the feature depends.            </p>
        </div>
    
    </div>
    
    <div class="section-2"  id="66322833_HighAvailabilityGuide-HTTPServices"  >
        <h2>HTTP Services</h2>
    
            <p>
    This section summarises the HTTP-based clustering features.            </p>
        <div class="section-3"  id="66322833_HighAvailabilityGuide-SubsystemSupport"  >
        <h3>Subsystem Support</h3>
    
            <p>
    This section describes the key clustering subsystems, JGroups and Infinispan. Say a few words about how they work together.            </p>
        <div class="section-4"  id="66322833_HighAvailabilityGuide-JGroupsSubsystem"  >
        <h4>JGroups Subsystem</h4>
    
    </div>
    
    <div class="section-4"  id="66322833_HighAvailabilityGuide-Purpose"  >
        <h4>Purpose</h4>
    
            <p>
    The JGroups subsystem provides group communication support for HA services in the form of JGroups channels.            </p>
                <p>
    Named channel instances permit application peers in a cluster to communicate as a group and in such a way that the communication satisfies defined properties (e.g. reliable, ordered, failure-sensitive). Communication properties are configurable for each channel and are defined by the protocol stack used to create the channel. Protocol stacks consist of a base transport layer (used to transport messages around the cluster) together with a user-defined, ordered stack of protocol layers, where each protocol layer supports a given communication property.            </p>
                <p>
    The JGroups subsystem provides the following features:            </p>
    <ul class=" "><li class=" ">            <p>
    allows definition of named protocol stacks            </p>
    </li><li class=" ">            <p>
    view run-time metrics associated with channels            </p>
    </li><li class=" ">            <p>
    specify a default stack for general use            </p>
    </li></ul>            <p>
    In the following sections, we describe the JGroups subsystem.            </p>
        <div class="confbox admonition admonition-note">
        
            <p>
    JGroups channels are created transparently as part of the clustering functionality (e.g. on clustered application deployment, channels will be created behind the scenes to support clustered features such as session replication or transmission of SSO contexts around the cluster).            </p>
        </div>
    
    </div>
    
    <div class="section-4"  id="66322833_HighAvailabilityGuide-Configurationexample"  >
        <h4>Configuration example</h4>
    
            <p>
    What follows is a sample JGroups subsystem configuration showing all of the possible elements and attributes which may be configured. We shall use this example to explain the meaning of the various elements and attributes.            </p>
        <div class="confbox admonition admonition-note">
        
            <p>
    The schema for the subsystem, describing all valid elements and attributes, can be found in the Wildfly distribution, in the docs/schema directory.            </p>
        </div>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;subsystem xmlns=&quot;urn:jboss:domain:jgroups:2.0&quot; default-stack=&quot;udp&quot;&gt;
    &lt;stack name=&quot;udp&quot;&gt;
        &lt;transport type=&quot;UDP&quot; socket-binding=&quot;jgroups-udp&quot; diagnostics-socket-binding=&quot;jgroups-diagnostics&quot;
            default-executor=&quot;jgroups&quot; oob-executor=&quot;jgroups-oob&quot; timer-executor=&quot;jgroups-timer&quot;
            shared=&quot;false&quot; thread-factory=&quot;jgroups-thread-factory&quot;
            machine=&quot;machine1&quot; rack=&quot;rack1&quot; site=&quot;site1&quot;/&gt;
        &lt;protocol type=&quot;PING&quot;&gt;
            &lt;property name=&quot;timeout&quot;&gt;100&lt;/property&gt;
        &lt;/protocol&gt;
        &lt;protocol type=&quot;MERGE3&quot;/&gt;
        &lt;protocol type=&quot;FD_SOCK&quot; socket-binding=&quot;jgroups-udp-fd&quot;/&gt;
        &lt;protocol type=&quot;FD&quot;/&gt;
        &lt;protocol type=&quot;VERIFY_SUSPECT&quot;/&gt;
        &lt;protocol type=&quot;pbcast.NAKACK2&quot;/&gt;
        &lt;protocol type=&quot;UNICAST2&quot;/&gt;
        &lt;protocol type=&quot;pbcast.STABLE&quot;/&gt;
        &lt;protocol type=&quot;pbcast.GMS&quot;/&gt;
        &lt;protocol type=&quot;UFC&quot;/&gt;
        &lt;protocol type=&quot;MFC&quot;/&gt;
        &lt;protocol type=&quot;FRAG2&quot;/&gt;
        &lt;protocol type=&quot;RSVP&quot;/&gt;
    &lt;/stack&gt;
    &lt;stack name=&quot;tcp&quot;&gt;
        &lt;transport type=&quot;TCP&quot; socket-binding=&quot;jgroups-tcp&quot;/&gt;
        &lt;protocol type=&quot;MPING&quot; socket-binding=&quot;jgroups-mping&quot;/&gt;
        &lt;protocol type=&quot;MERGE2&quot;/&gt;
        &lt;protocol type=&quot;FD_SOCK&quot; socket-binding=&quot;jgroups-tcp-fd&quot;/&gt;
        &lt;protocol type=&quot;FD&quot;/&gt;
        &lt;protocol type=&quot;VERIFY_SUSPECT&quot;/&gt;
        &lt;protocol type=&quot;pbcast.NAKACK2&quot;/&gt;
        &lt;protocol type=&quot;UNICAST2&quot;/&gt;
        &lt;protocol type=&quot;pbcast.STABLE&quot;/&gt;
        &lt;protocol type=&quot;pbcast.GMS&quot;/&gt;
        &lt;protocol type=&quot;MFC&quot;/&gt;
        &lt;protocol type=&quot;FRAG2&quot;/&gt;
        &lt;protocol type=&quot;RSVP&quot;/&gt;
    &lt;/stack&gt;
    &lt;stack name=&quot;udp-xsite&quot;&gt;
        &lt;transport type=&quot;UDP&quot; socket-binding=&quot;jgroups-udp&quot;/&gt;
        &lt;protocol type=&quot;PING&quot; socket-binding=&quot;jgroups-mping&quot;/&gt;
        &lt;protocol type=&quot;MERGE2&quot;/&gt;
        &lt;protocol type=&quot;FD_SOCK&quot; socket-binding=&quot;jgroups-tcp-fd&quot;/&gt;
        &lt;protocol type=&quot;FD&quot;/&gt;
        &lt;protocol type=&quot;VERIFY_SUSPECT&quot;/&gt;
        &lt;protocol type=&quot;pbcast.NAKACK2&quot;/&gt;
        &lt;protocol type=&quot;UNICAST2&quot;/&gt;
        &lt;protocol type=&quot;pbcast.STABLE&quot;/&gt;
        &lt;protocol type=&quot;pbcast.GMS&quot;/&gt;
        &lt;protocol type=&quot;MFC&quot;/&gt;
        &lt;protocol type=&quot;FRAG2&quot;/&gt;
        &lt;protocol type=&quot;RSVP&quot;/&gt;
        &lt;relay site=&quot;LONDON&quot;&gt;
            &lt;remote-site name=&quot;SFO&quot; stack=&quot;tcp&quot; cluster=&quot;global&quot;/&gt;
            &lt;remote-site name=&quot;NYC&quot; stack=&quot;tcp&quot; cluster=&quot;global&quot;/&gt;
        &lt;/relay&gt;
    &lt;/stack&gt;
&lt;/subsystem&gt;
</code></pre>
        </div>
    </div>
    <div class="section-5"  id="66322833_HighAvailabilityGuide-%3Csubsystem%3E"  >
        <h5>&lt;subsystem&gt;</h5>
    
            <p>
    This element is used to configure the subsystem within a Wildfly system profile.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">xmlns</tt> This attribute specifies the XML namespace of the JGroups subsystem and, in particular, its version.            </p>
    </li></ul><ul class="alternate "><li class=" ">            <p>
    <tt class=" ">default-stack</tt> This attribute is used to specify a default stack for the JGroups subsystem. This default stack will be used whenever a stack is required but no stack is specified.            </p>
    </li></ul>    </div>
    
    <div class="section-5"  id="66322833_HighAvailabilityGuide-%3Cstack%3E"  >
        <h5>&lt;stack&gt;</h5>
    
            <p>
    This element is used to configure a JGroups protocol stack.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">name</tt> This attribute is used to specify the name of the stack.            </p>
    </li></ul>    </div>
    
    <div class="section-5"  id="66322833_HighAvailabilityGuide-%3Ctransport%3E"  >
        <h5>&lt;transport&gt;</h5>
    
            <p>
    This element is used to configure the transport layer (required) of the protocol stack.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">type</tt> This attribute specifies the transport type (e.g. UDP, TCP, TCPGOSSIP)            </p>
    </li><li class=" ">            <p>
    <tt class=" ">socket-binding</tt> This attribute references a defined socket binding in the server profile. It is used when JGroups needs to create general sockets internally.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">diagnostics-socket-binding</tt> This attribute references a defined socket binding in the server profile. It is used when JGroups needs to create sockets for use with the diagnostics program. For more about the use of diagnostics, see the JGroups documentation for probe.sh.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">default-executor</tt> This attribute references a defined thread pool executor in the threads subsystem. It governs the allocation and execution of runnable tasks to handle incoming JGroups messages.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">oob-executor</tt> This attribute references a defined thread pool executor in the threads subsystem. It governs the allocation and execution of runnable tasks to handle incoming JGroups OOB (out-of-bound) messages.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">timer-executor</tt> This attribute references a defined thread pool executor in the threads subsystem. It governs the allocation and execution of runnable timer-related tasks.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">shared</tt> This attribute indicates whether or not this transport is shared amongst several JGroups stacks or not.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">thread-factory</tt> This attribute references a defined thread factory in the threads subsystem. It governs the allocation of threads for running tasks which are not handled by the executors above.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">site</tt> This attribute defines a site (data centre) id for this node.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">rack</tt> This attribute defines a rack (server rack) id for this node.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">machine</tt> This attribute defines a machine (host) is for this node.            </p>
    </li></ul>    <div class="confbox admonition admonition-note">
        
            <p>
    site, rack and machine ids are used by the Infinispan topology-aware consistent hash function, which when using dist mode, prevents   dist mode replicas from being stored on the same host, rack or site            </p>
        </div>
    
            <p>
    .            </p>
        <div class="section-6"  id="66322833_HighAvailabilityGuide-%3Cproperty%3E"  >
        <h6>&lt;property&gt;</h6>
    
            <p>
    This element is used to configure a transport property.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">name</tt> This attribute specifies the name of the protocol property. The value is provided as text for the property element.            </p>
    </li></ul>    </div>
    
    </div>
    
    <div class="section-5"  id="66322833_HighAvailabilityGuide-%3Cprotocol%3E"  >
        <h5>&lt;protocol&gt;</h5>
    
            <p>
    This element is used to configure a (non-transport) protocol layer in the JGroups stack. Protocol layers are ordered within the stack.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">type</tt> This attribute specifies the name of the JGroups protocol implementation (e.g. MPING, pbcast.GMS), with the package prefix org.jgroups.protocols removed.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">socket-binding</tt> This attribute references a defined socket binding in the server profile. It is used when JGroups needs to create general sockets internally for this protocol instance.            </p>
    </li></ul>    <div class="section-6"  id="66322833_HighAvailabilityGuide-%3Cproperty%3E2"  >
        <h6>&lt;property&gt;</h6>
    
            <p>
    This element is used to configure a protocol property.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">name</tt> This attribute specifies the name of the protocol property. The value is provided as text for the property element.            </p>
    </li></ul>    </div>
    
    </div>
    
    <div class="section-5"  id="66322833_HighAvailabilityGuide-%3Crelay%3E"  >
        <h5>&lt;relay&gt;</h5>
    
            <p>
    This element is used to configure the RELAY protocol for a JGroups stack. RELAY is a protocol which provides cross-site replication between defined sites (data centres). In the RELAY protocol, defined sites specify the names of remote sites (backup sites) to which their data should be backed up. Channels are defined between sites to permit the RELAY protocol to transport the data from the current site to a backup site.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">site</tt> This attribute specifies the name of the current site. Site names can be referenced elsewhere (e.g. in the JGroups remote-site configuration elements, as well as backup configuration elements in the Infinispan subsystem)            </p>
    </li></ul>    <div class="section-6"  id="66322833_HighAvailabilityGuide-%3Cremotesite%3E"  >
        <h6>&lt;remote-site&gt;</h6>
    
            <p>
    This element is used to configure a remote site for the RELAY protocol.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">name</tt> This attribute specifies the name of the remote site to which this configuration applies.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">stack</tt> This attribute specifies a JGroups protocol stack to use for communication between this site and the remote site.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">cluster</tt> This attribute specifies the name of the JGroups channel to use for communication between this site and the remote site.            </p>
    </li></ul>    </div>
    
    </div>
    
    </div>
    
    <div class="section-4"  id="66322833_HighAvailabilityGuide-UseCases"  >
        <h4>Use Cases</h4>
    
            <p>
    In many cases, channels will be configured via XML as in the example above, so that the channels will be available upon server startup. However, channels may also be added, removed or have their configurations changed in a running server by making use of the Wildfly management API command-line interface (CLI).&nbsp;In this section, we present some key use cases for the JGroups management API.            </p>
                <p>
    The key use cases covered are:            </p>
    <ul class="alternate "><li class=" ">            <p>
    adding a stack            </p>
    </li><li class=" ">            <p>
    adding a protocol to an existing stack            </p>
    </li><li class=" ">            <p>
    adding a property to a protocol            </p>
    </li></ul>    <div class="confbox admonition admonition-note">
        
            <p>
    The Wildfly management API command-line interface (CLI) itself can be used to provide extensive information on the attributes and commands available in the JGroups subsystem interface used in these examples.            </p>
        </div>
    
    <div class="section-5"  id="66322833_HighAvailabilityGuide-Addastack"  >
        <h5>Add a stack</h5>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre><code>/subsystem=jgroups/stack=mystack:add(transport={}, protocols={})</code></pre>
        </div>
    </div>
    </div>
    
    <div class="section-5"  id="66322833_HighAvailabilityGuide-Addaprotocoltoastack"  >
        <h5>Add a protocol to a stack</h5>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre><code>/subsystem=jgroups/stack=mystack/transport=TRANSPORT:add(type=&lt;type&gt;, socket-binding=&lt;socketbinding&gt;)</code></pre>
        </div>
    </div>
    <div class="confbox programlisting">
                <div class="content">
        <pre><code>/subsystem=jgroups/stack=mystack:add-protocol(type=&lt;type&gt;, socket-binding=&lt;socketbinding&gt;)</code></pre>
        </div>
    </div>
    </div>
    
    <div class="section-5"  id="66322833_HighAvailabilityGuide-Addapropertytoaprotocol"  >
        <h5>Add a property to a protocol</h5>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre><code>/subsystem=jgroups/stack=mystack/transport=TRANSPORT/property=&lt;property&gt;:add(value=&lt;value&gt;)</code></pre>
        </div>
    </div>
    </div>
    
    <div class="section-5"  id="66322833_HighAvailabilityGuide-InfinispanSubsystem"  >
        <h5>Infinispan Subsystem</h5>
    
    </div>
    
    </div>
    
    <div class="section-4"  id="66322833_HighAvailabilityGuide-Purpose2"  >
        <h4>Purpose</h4>
    
            <p>
    The Infinispan subsystem provides caching support for HA services in the form of Infinispan caches: &nbsp;high-performance, transactional caches which can operate in both non-distributed and distributed scenarios.&nbsp;Distributed caching support is used in the provision of many key HA services. For example, the failover of a session-oriented client HTTP request from a failing node to a new (failover) node depends on session data for the client being available on the new node. In other words, the client session data needs to be replicated across nodes in the cluster. This is effectively achieved via a distributed Infinispan cache. This approach to providing fail-over also applies to EJB SFSB sessions. Over and above providing support for fail-over, an underlying cache is also required when providing second-level caching for entity beans using Hibernate, and this case is also handled through the use of an Infinispan cache.            </p>
                <p>
    The Infinispan subsystem provides the following features:            </p>
    <ul class=" "><li class=" ">            <p>
    allows definition and configuration of named cache containers and caches            </p>
    </li><li class=" ">            <p>
    view run-time metrics associated with cache container and cache instances            </p>
    </li></ul>            <p>
    In the following sections, we describe the Infinispan subsystem.            </p>
        <div class="confbox admonition admonition-note">
        
            <p>
    Infinispan cache containers and caches are created transparently as part of the clustering functionality (e.g. on clustered application deployment, cache containers and their associated caches will be created behind the scenes to support clustered features such as session replication or caching of entities around the cluster).            </p>
        </div>
    
    </div>
    
    <div class="section-4"  id="66322833_HighAvailabilityGuide-ConfigurationExample"  >
        <h4>Configuration Example</h4>
    
            <p>
    In this section, we provide an example XML configuration of the infinispan subsystem and review the configuration elements and attributes.            </p>
        <div class="confbox admonition admonition-note">
        
            <p>
    The schema for the subsystem, describing all valid elements and attributes, can be found in the Wildfly distribution, in the docs/schema directory.            </p>
        </div>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;subsystem xmlns=&quot;urn:jboss:domain:infinispan:2.0&quot;&gt;
  &lt;cache-container name=&quot;server&quot; aliases=&quot;singleton cluster&quot; default-cache=&quot;default&quot; module=&quot;org.wildfly.clustering.server&quot;&gt;
      &lt;transport lock-timeout=&quot;60000&quot;/&gt;
      &lt;replicated-cache name=&quot;default&quot; mode=&quot;SYNC&quot; batching=&quot;true&quot;&gt;
          &lt;locking isolation=&quot;REPEATABLE_READ&quot;/&gt;
      &lt;/replicated-cache&gt;
  &lt;/cache-container&gt;
  &lt;cache-container name=&quot;web&quot; aliases=&quot;standard-session-cache&quot; default-cache=&quot;repl&quot; module=&quot;org.wildfly.clustering.web.infinispan&quot;&gt;
      &lt;transport lock-timeout=&quot;60000&quot;/&gt;
      &lt;replicated-cache name=&quot;repl&quot; mode=&quot;ASYNC&quot; batching=&quot;true&quot;&gt;
          &lt;file-store/&gt;
      &lt;/replicated-cache&gt;
      &lt;replicated-cache name=&quot;sso&quot; mode=&quot;SYNC&quot; batching=&quot;true&quot;/&gt;
      &lt;distributed-cache name=&quot;dist&quot; mode=&quot;ASYNC&quot; batching=&quot;true&quot; l1-lifespan=&quot;0&quot;&gt;
          &lt;file-store/&gt;
      &lt;/distributed-cache&gt;
  &lt;/cache-container&gt;
  &lt;cache-container name=&quot;ejb&quot; aliases=&quot;sfsb sfsb-cache&quot; default-cache=&quot;repl&quot; module=&quot;org.jboss.as.clustering.ejb3.infinispan&quot;&gt;
      &lt;transport lock-timeout=&quot;60000&quot;/&gt;
      &lt;replicated-cache name=&quot;repl&quot; mode=&quot;ASYNC&quot; batching=&quot;true&quot;&gt;
          &lt;eviction strategy=&quot;LRU&quot; max-entries=&quot;10000&quot;/&gt;
          &lt;file-store/&gt;
      &lt;/replicated-cache&gt;
      &lt;!--
        ~  Clustered cache used internally by EJB subsytem for managing the client-mapping(s) of
        ~                 the socketbinding referenced by the EJB remoting connector
        --&gt;
      &lt;replicated-cache name=&quot;remote-connector-client-mappings&quot; mode=&quot;SYNC&quot; batching=&quot;true&quot;/&gt;
      &lt;distributed-cache name=&quot;dist&quot; mode=&quot;ASYNC&quot; batching=&quot;true&quot; l1-lifespan=&quot;0&quot;&gt;
          &lt;eviction strategy=&quot;LRU&quot; max-entries=&quot;10000&quot;/&gt;
          &lt;file-store/&gt;
      &lt;/distributed-cache&gt;
  &lt;/cache-container&gt;
  &lt;cache-container name=&quot;hibernate&quot; default-cache=&quot;local-query&quot; module=&quot;org.hibernate&quot;&gt;
      &lt;transport lock-timeout=&quot;60000&quot;/&gt;
      &lt;local-cache name=&quot;local-query&quot;&gt;
          &lt;transaction mode=&quot;NONE&quot;/&gt;
          &lt;eviction strategy=&quot;LRU&quot; max-entries=&quot;10000&quot;/&gt;
          &lt;expiration max-idle=&quot;100000&quot;/&gt;
      &lt;/local-cache&gt;
      &lt;invalidation-cache name=&quot;entity&quot; mode=&quot;SYNC&quot;&gt;
          &lt;transaction mode=&quot;NON_XA&quot;/&gt;
          &lt;eviction strategy=&quot;LRU&quot; max-entries=&quot;10000&quot;/&gt;
          &lt;expiration max-idle=&quot;100000&quot;/&gt;
      &lt;/invalidation-cache&gt;
      &lt;replicated-cache name=&quot;timestamps&quot; mode=&quot;ASYNC&quot;&gt;
          &lt;transaction mode=&quot;NONE&quot;/&gt;
          &lt;eviction strategy=&quot;NONE&quot;/&gt;
       &lt;/replicated-cache&gt;
  &lt;/cache-container&gt;
&lt;/subsystem&gt;</code></pre>
        </div>
    </div>
<ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Purpose">Purpose</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-ConfigurationExample">Configuration Example</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Ccachecontainer%3E">&lt;cache-container&gt;</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Ctransport%3E">&lt;transport&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Cabstractcache%3E">&lt;abstract cache&gt;</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Cindexingproperties%3E">&lt;indexing-properties&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Clocking%3E">&lt;locking&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Ctransaction%3E">&lt;transaction&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Ceviction%3E">&lt;eviction&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Cexpiration%3E">&lt;expiration&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Cabstractbasestore%3E">&lt;abstract base-store&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Cwritebehind%3E">&lt;write-behind&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Cabstractbasejdbcstore%3Eextends%3Cabstractbasestore%3E">&lt;abstract base-jdbc-store&gt; extends &lt;abstract base-store&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Cfilestore%3Eextends%3Cabstractbasestore%3E">&lt;file-store&gt; extends &lt;abstract base-store&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Cremotestore%3Eextends%3Cabstractbasestore%3E">&lt;remote-store&gt; extends &lt;abstract base-store&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Cremoteservers%3E">&lt;remote-servers&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Cremoteserver%3E">&lt;remote-server&gt;</a>            </p>
    </li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-"></a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Clocalcache%3Eextends%3Cabstractcache%3E">&lt;local-cache&gt; extends &lt;abstract cache&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Cabstractclusteredcache%3Eextends%3Cabstractcache%3E">&lt;abstract clustered-cache&gt; extends &lt;abstract cache&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-"></a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Cinvalidationcache%3Eextends%3Cabstractclusteredcache%3E">&lt;invalidation-cache&gt; extends &lt;abstract clustered-cache&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Cabstractsharedcache%3Eextends%3Cabstractclusteredcache%3E">&lt;abstract shared-cache&gt; extends &lt;abstract clustered-cache&gt;</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Cstatetransfer%3E">&lt;state-transfer&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Cbackups%3E">&lt;backups&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Cbackup%3E">&lt;backup&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Cbackupfor%3E">&lt;backup-for&gt;</a>            </p>
    </li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Creplicatedcache%3Eextends%3Cabstractsharedcache%3E">&lt;replicated-cache&gt; extends &lt;abstract shared-cache&gt;</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-%3Cdistributedcache%3Eextends%3Cabstractsharedcache%3E">&lt;distributed-cache&gt; extends &lt;abstract shared-cache&gt;</a>            </p>
    </li></ul></li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-UseCases">Use Cases</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Addacachecontainer">Add a cache container</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Addacache">Add a cache</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Configurethetransactioncomponentofacache">Configure the transaction component of a cache</a>            </p>
    </li></ul></li></ul>    <div class="section-5"  id="66322833_HighAvailabilityGuide-%3Ccachecontainer%3E"  >
        <h5>&lt;cache-container&gt;</h5>
    
            <p>
    This element is used to configure a cache container.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">name</tt> This attribute is used to specify the name of the cache container.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">default-cache</tt> This attribute configures the default cache to be used, when no cache is otherwise specified.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">listener-executor</tt> This attribute references a defined thread pool executor in the threads subsystem. It governs the allocation and execution of runnable tasks in the replication queue.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">eviction-executor</tt> This attribute references a defined thread pool executor in the threads subsystem. It governs the allocation and execution of runnable tasks to handle evictions.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">replication-queue-executor</tt> This attribute references a defined thread pool executor in the threads subsystem. It governs the allocation and execution of runnable tasks to handle asynchronous cache operations.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">jndi-name</tt> This attribute is used to assign a name for the cache container in the JNDI name service.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">module</tt> This attribute configures the module whose class loader should be used when building this cache container's configuration.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">start</tt> This attribute configures the cache container start mode, which can be EAGER (immediate start) or LAZY (on-demand start).            </p>
    </li><li class=" ">            <p>
    <tt class=" ">aliases</tt> This attribute is used to define aliases for the cache container name.            </p>
    </li></ul>            <p>
    This element has the following child elements: <strong class=" ">&lt;transport&gt;</strong>, <strong class=" ">&lt;local-cache&gt;</strong>, <strong class=" ">&lt;invalidation-cache&gt;</strong>, <strong class=" ">&lt;replicated-cache&gt;</strong>, and <strong class=" ">&lt;distributed-cache&gt;</strong>.            </p>
        <div class="section-6"  id="66322833_HighAvailabilityGuide-%3Ctransport%3E2"  >
        <h6>&lt;transport&gt;</h6>
    
            <p>
    This element is used to configure the JGroups transport used by the cache container, when required.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">stack</tt> This attribute configures the JGroups stack to be used for the transport. If none is specified, the default-stack for the JGroups subsystem is used.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">cluster</tt> This attribute configures the name of the group communication cluster. This is the name which will be seen in debugging logs.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">executor</tt> This attribute references a defined thread pool executor in the threads subsystem. It governs the allocation and execution of runnable tasks to handle ?    <cite>
&lt;fill me in    </cite>
&gt;?.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">lock-timeout</tt> This attribute configures the time-out to be used when obtaining locks for the transport.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">site</tt> This attribute configures the site id of the cache container.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">rack</tt> This attribute configures the rack id of the cache container.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">machine</tt> This attribute configures the machine id of the cache container.            </p>
        <div class="confbox admonition admonition-note">
        
            <p>
    The presence of the transport element is required when operating in clustered mode            </p>
        </div>
    
</li></ul>            <p>
    The remaining child elements of <strong class=" ">&lt;cache-container&gt;</strong>, namely <strong class=" ">&lt;local-cache&gt;</strong>, <strong class=" ">&lt;invalidation-cache&gt;</strong>, <strong class=" ">&lt;replicated-cache&gt;</strong> and <strong class=" ">&lt;distributed-cache&gt;</strong>, each configures one of four key cache types or classifications.            </p>
        <div class="confbox admonition admonition-note">
        
            <p>
    These cache-related elements are actually part of an xsd hierarchy with abstract complexTypes <strong class=" ">cache</strong>, <strong class=" ">clustered-cache</strong>, and <strong class=" ">shared-cache</strong>. In order to simplify the presentation, we notate these as pseudo-elements <strong class=" ">&lt;abstract cache&gt;</strong>, <strong class=" ">&lt;abstract clustered-cache&gt;</strong> and <strong class=" ">&lt;abstract shared-cache&gt;</strong>. In what follows, we first describe the extension hierarchy of base elements, and then show how the cache type elements relate to them.            </p>
        </div>
    
    </div>
    
    <div class="section-6"  id="66322833_HighAvailabilityGuide-%3Cabstractcache%3E"  >
        <h6>&lt;abstract cache&gt;</h6>
    
            <p>
    This abstract base element defines the attributes and child elements common to all non-clustered caches.&nbsp;            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">name</tt> This attribute configures the name of the cache. This name may be referenced by other subsystems.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">start</tt> This attribute configures the cache start mode, which can be EAGER (immediate start) or LAZY (on-demand start).            </p>
    </li><li class=" ">            <p>
    <tt class=" ">batching</tt> This attribute configures batching. If enabled, the invocation batching API will be made available for this cache.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">indexing</tt> This attribute configures indexing. If enabled, entries will be indexed when they are added to the cache. Indexes will be updated as entries change or are removed.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">jndi-name</tt> This attribute is used to assign a name for the cache in the JNDI name service.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">module</tt> This attribute configures the module whose class loader should be used when building this cache container's configuration.            </p>
    </li></ul>            <p>
    The &lt;abstract cache&gt; abstract base element has the following child elements: <strong class=" ">&lt;indexing-properties&gt;, &lt;locking&gt;</strong>, <strong class=" ">&lt;transaction&gt;</strong>, <strong class=" ">&lt;eviction&gt;</strong>, <strong class=" ">&lt;expiration&gt;</strong>, <strong class=" ">&lt;store&gt;</strong>, <strong class=" ">&lt;file-store&gt;</strong>, <strong class=" ">&lt;string-keyed-jdbc-store&gt;</strong>, <strong class=" ">&lt;binary-keyed-jdbc-store&gt;</strong>, <strong class=" ">&lt;mixed-keyed-jdbc-store&gt;</strong>, <strong class=" ">&lt;remote-store&gt;</strong>.            </p>
        <div class="section-7"  id="66322833_HighAvailabilityGuide-%3Cindexingproperties%3E"  >
        <h7>&lt;indexing-properties&gt;</h7>
    
            <p>
    This child element defines properties to control indexing behaviour.            </p>
        </div>
    
    <div class="section-7"  id="66322833_HighAvailabilityGuide-%3Clocking%3E"  >
        <h7>&lt;locking&gt;</h7>
    
            <p>
    This child element configures the locking behaviour of the cache.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">isolation</tt> This attribute the cache locking isolation level. Allowable values are NONE, SERIALIZABLE, REPEATABLE_READ, READ_COMMITTED, READ_UNCOMMITTED.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">striping</tt> If true, a pool of shared locks is maintained for all entries that need to be locked. Otherwise, a lock is created per entry in the cache. Lock striping helps control memory footprint but may reduce concurrency in the system.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">acquire-timeout</tt> This attribute configures the maximum time to attempt a particular lock acquisition.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">concurrency-level</tt> This attribute is used to configure the concurrency level. Adjust this value according to the number of concurrent threads interacting with Infinispan.            </p>
    </li></ul>    </div>
    
    <div class="section-7"  id="66322833_HighAvailabilityGuide-%3Ctransaction%3E"  >
        <h7>&lt;transaction&gt;</h7>
    
            <p>
    This child element configures the transactional behaviour of the cache.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">mode</tt> This attribute configures the transaction mode, setting the cache transaction mode to one of NONE, NON_XA, NON_DURABLE_XA, FULL_XA.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">stop-timeout</tt> If there are any ongoing transactions when a cache is stopped, Infinispan waits for ongoing remote and local transactions to finish. The amount of time to wait for is defined by the cache stop timeout.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">locking</tt> This attribute configures the locking mode for this cache, one of OPTIMISTIC or PESSIMISTIC.            </p>
    </li></ul>    </div>
    
    <div class="section-7"  id="66322833_HighAvailabilityGuide-%3Ceviction%3E"  >
        <h7>&lt;eviction&gt;</h7>
    
            <p>
    This child element configures the eviction behaviour of the cache.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">strategy</tt> This attribute configures the cache eviction strategy. Available options are 'UNORDERED', 'FIFO', 'LRU', 'LIRS' and 'NONE' (to disable eviction).            </p>
    </li><li class=" ">            <p>
    <tt class=" ">max-entries</tt> This attribute configures the maximum number of entries in a cache instance. If selected value is not a power of two the actual value will default to the least power of two larger than selected value. -1 means no limit.            </p>
    </li></ul>    </div>
    
    <div class="section-7"  id="66322833_HighAvailabilityGuide-%3Cexpiration%3E"  >
        <h7>&lt;expiration&gt;</h7>
    
            <p>
    This child element configures the expiration behaviour of the cache.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">max-idle</tt> This attribute configures the maximum idle time a cache entry will be maintained in the cache, in milliseconds. If the idle time is exceeded, the entry will be expired cluster-wide. -1 means the entries never expire.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">lifespan</tt> This attribute configures the maximum lifespan of a cache entry, after which the entry is expired cluster-wide, in milliseconds. -1 means the entries never expire.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">interval</tt> This attribute specifies the interval (in ms) between subsequent runs to purge expired entries from memory and any cache stores. If you wish to disable the periodic eviction process altogether, set wakeupInterval to -1.            </p>
    </li></ul>            <p>
    The remaining child elements of the abstract base element <strong class=" ">&lt;cache&gt;</strong>, namely <strong class=" ">&lt;store&gt;</strong>, <strong class=" ">&lt;file-store&gt;</strong>, <strong class=" ">&lt;remote-store&gt;</strong>, <strong class=" ">&lt;string-keyed-jdbc-store&gt;</strong>, <strong class=" ">&lt;binary-keyed-jdbc-store&gt;</strong> and <strong class=" ">&lt;mixed-keyed-jdbc-store&gt;</strong>, each configures one of six key cache store types.            </p>
        <div class="confbox admonition admonition-note">
        
            <p>
    These cache store-related elements are actually part of an xsd extension hierarchy with abstract complexTypes <strong class=" ">base-store</strong> and <strong class=" ">base-jdbc-store</strong>. As before, in order to simplify the presentation, we notate these as pseudo-elements <strong class=" ">&lt;abstract base-store&gt;</strong> and <strong class=" ">&lt;abstract base-jdbc-store&gt;</strong>.&nbsp; In what follows, we first  describe the extension hierarchy of base elements, and then show how the  cache store elements relate to them.            </p>
        </div>
    
    </div>
    
    <div class="section-7"  id="66322833_HighAvailabilityGuide-%3Cabstractbasestore%3E"  >
        <h7>&lt;abstract base-store&gt;</h7>
    
            <p>
    This abstract base element defines the attributes and child elements common to all cache stores.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">shared</tt> This attribute should be set to true when multiple cache instances share the same cache store (e.g. multiple nodes in a cluster using a JDBC-based CacheStore pointing to the same, shared database) Setting this to true avoids multiple cache instances writing the same modification multiple times. If enabled, only the node where the modification originated will write to the cache store. If disabled, each individual cache reacts to a potential remote update by storing the data to the cache store.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">preload</tt> This attribute configures whether or not, when the cache starts, data stored in the cache loader will be  pre-loaded into memory. This is particularly useful when data in the  cache loader is needed immediately after start-up and you want to avoid  cache operations being delayed as a result of loading this data lazily.  Can be used to provide a 'warm-cache' on start-up, however there is a  performance penalty as start-up time is affected by this process. Note  that pre-loading is done in a local fashion, so any data loaded is only  stored locally in the node. No replication or distribution of the  preloaded data happens. Also, Infinispan only pre-loads up to the maximum  configured number of entries in eviction.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">passivation</tt> If true, data is only written to the cache store when it is evicted from memory, a phenomenon known as <i class=" ">passivation</i>. Next time the data is requested, it will be 'activated' which means that data will be brought back to memory and removed from the persistent store. If false, the cache store contains a copy of the cache contents in memory, so writes to cache result in cache store writes. This essentially gives you a 'write-through' configuration.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">fetch-state</tt> This attribute, if true, causes persistent state to be fetched when joining a cluster. If multiple cache stores are chained, only one of them can have this property enabled.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">purge</tt> This attribute configures whether the cache store is purged upon start-up.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">singleton</tt> This attribute configures whether or not the singleton store cache store is enabled. SingletonStore is a delegating cache store used for situations when only one instance in a cluster should interact with the underlying store.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">class</tt> This attribute configures a custom store implementation class to use for this cache store.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">properties</tt> This attribute is used to configure a list of cache store properties.            </p>
    </li></ul>            <p>
    The abstract base element has one child element: <strong class=" ">&lt;write-behind&gt;</strong>            </p>
        </div>
    
    <div class="section-7"  id="66322833_HighAvailabilityGuide-%3Cwritebehind%3E"  >
        <h7>&lt;write-behind&gt;</h7>
    
            <p>
    This element is used to configure a cache store as write-behind instead of write-through. In write-through mode, writes to the cache are also <i class=" ">synchronously</i> written to the cache store, whereas in write-behind mode, writes to the cache are followed by <i class=" ">asynchronous</i> writes to the cache store.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">flush-lock-timeout</tt> This attribute configures the time-out for acquiring the lock which guards the state to be flushed to the cache store periodically.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">modification-queue-size</tt> This attribute configures the maximum number of entries in the asynchronous queue. When the queue is full, the store becomes write-through until it can accept new entries.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">shutdown-timeout</tt> This attribute configures the time-out (in ms) to stop the cache store.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">thread-pool</tt> This attribute is used to configure the size of the thread pool whose threads are responsible for applying the modifications to the cache store.            </p>
    </li></ul>    </div>
    
    <div class="section-7"  id="66322833_HighAvailabilityGuide-%3Cabstractbasejdbcstore%3Eextends%3Cabstractbasestore%3E"  >
        <h7>&lt;abstract base-jdbc-store&gt; extends &lt;abstract base-store&gt;</h7>
    
            <p>
    This abstract base element defines the attributes and child elements common to all JDBC-based cache stores.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">datasource</tt> This attribute configures the datasource for the JDBC-based cache store.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">entry-table</tt> This attribute configures the database table used to store cache entries.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">bucket-table</tt> This attribute configures the database table used to store binary cache entries.            </p>
    </li></ul>    </div>
    
    <div class="section-7"  id="66322833_HighAvailabilityGuide-%3Cfilestore%3Eextends%3Cabstractbasestore%3E"  >
        <h7>&lt;file-store&gt; extends &lt;abstract base-store&gt;</h7>
    
            <p>
    This child element is used to configure a file-based cache store. This requires specifying the name of the file to be used as backing storage for the cache store.&nbsp;            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">relative-to</tt> This attribute optionally configures a relative path prefix for the file store path. Can be null.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">path</tt> This attribute configures an absolute path to a file if <strong class=" ">relative-to</strong> is null; configures a relative path to the file, in relation to the value for <strong class=" ">relative-to</strong>, otherwise.            </p>
    </li></ul>    </div>
    
    <div class="section-7"  id="66322833_HighAvailabilityGuide-%3Cremotestore%3Eextends%3Cabstractbasestore%3E"  >
        <h7>&lt;remote-store&gt; extends &lt;abstract base-store&gt;</h7>
    
            <p>
    This child element of cache is used to configure a remote cache store. It has a child &lt;remote-servers&gt;.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">cache</tt> This attribute configures the name of the remote cache to use for this remote store.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">tcp-nodelay</tt> This attribute configures a TCP_NODELAY value for communication with the remote cache.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">socket-timeout</tt> This attribute configures a socket time-out for communication with the remote cache.            </p>
    </li></ul>    </div>
    
    <div class="section-7"  id="66322833_HighAvailabilityGuide-%3Cremoteservers%3E"  >
        <h7>&lt;remote-servers&gt;</h7>
    
            <p>
    This child element of cache configures a list of remote servers for this cache store.            </p>
        </div>
    
    <div class="section-7"  id="66322833_HighAvailabilityGuide-%3Cremoteserver%3E"  >
        <h7>&lt;remote-server&gt;</h7>
    
            <p>
    This element configures a remote server. A remote server is defined completely by a locally defined outbound socket binding, through which communication is made with the server.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">outbound-socket-binding</tt> This attribute configures an outbound socket binding for a remote server.            </p>
    </li></ul>    </div>
    
    </div>
    
    <div class="section-6"  id="66322833_HighAvailabilityGuide-"  >
        <h6></h6>
    
    </div>
    
    <div class="section-6"  id="66322833_HighAvailabilityGuide-%3Clocalcache%3Eextends%3Cabstractcache%3E"  >
        <h6>&lt;local-cache&gt; extends &lt;abstract cache&gt;</h6>
    
            <p>
    This element configures a local cache.            </p>
        </div>
    
    <div class="section-6"  id="66322833_HighAvailabilityGuide-%3Cabstractclusteredcache%3Eextends%3Cabstractcache%3E"  >
        <h6>&lt;abstract clustered-cache&gt; extends &lt;abstract cache&gt;</h6>
    
            <p>
    This abstract base element defines the attributes and child elements common to all clustered caches. A clustered cache is a cache which spans multiple nodes in a cluster. It inherits from &lt;cache&gt;, so that all attributes and elements of &lt;cache&gt; are also defined for &lt;clustered-cache&gt;.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">async-marshalling</tt> This attribute configures async marshalling. If enabled, this will cause marshalling of entries to be performed asynchronously.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">mode</tt> This attribute configures the clustered cache mode, ASYNC for asynchronous operation, or SYNC for synchronous operation.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">queue-size</tt> In ASYNC mode, this attribute can be used to trigger flushing of the queue when it reaches a specific threshold.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">queue-flush-interval</tt> In ASYNC mode, this attribute controls how often the asynchronous thread used to flush the replication queue runs. This should be a positive integer which represents thread wakeup time in milliseconds.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">remote-timeout</tt> In SYNC mode, this attribute (in ms) used to wait for an acknowledgement when making a remote call, after which the call is aborted and an exception is thrown.            </p>
    </li></ul>    </div>
    
    <div class="section-6"  id="66322833_HighAvailabilityGuide-2"  >
        <h6></h6>
    
    </div>
    
    <div class="section-6"  id="66322833_HighAvailabilityGuide-%3Cinvalidationcache%3Eextends%3Cabstractclusteredcache%3E"  >
        <h6>&lt;invalidation-cache&gt; extends &lt;abstract clustered-cache&gt;</h6>
    
            <p>
    This element configures an invalidation cache. &nbsp;            </p>
        </div>
    
    <div class="section-6"  id="66322833_HighAvailabilityGuide-%3Cabstractsharedcache%3Eextends%3Cabstractclusteredcache%3E"  >
        <h6>&lt;abstract shared-cache&gt; extends &lt;abstract clustered-cache&gt;</h6>
    
            <p>
    This abstract base element defines the attributes and child elements common to all shared caches.  A shared cache is a clustered cache which shares state with its cache peers in the cluster.  It inherits from &lt;clustered-cache&gt;, so that all attributes and elements of  &lt;clustered-cache&gt; are also defined for &lt;shared-cache&gt;.            </p>
        <div class="section-7"  id="66322833_HighAvailabilityGuide-%3Cstatetransfer%3E"  >
        <h7>&lt;state-transfer&gt;</h7>
    
<ul class="alternate "><li class=" ">            <p>
    <tt class=" ">enabled</tt> If enabled, this will cause the cache to ask neighbouring caches for state when it starts up, so the cache starts 'warm', although it will impact start-up time.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">timeout</tt> This attribute configures the maximum amount of time (ms) to wait for state from neighbouring caches, before throwing an exception and aborting start-up.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">chunk-size</tt> This attribute configures the size, in bytes, in which to batch the transfer of cache entries.            </p>
    </li></ul>    </div>
    
    <div class="section-7"  id="66322833_HighAvailabilityGuide-%3Cbackups%3E"  >
        <h7>&lt;backups&gt;</h7>
    
    </div>
    
    <div class="section-7"  id="66322833_HighAvailabilityGuide-%3Cbackup%3E"  >
        <h7>&lt;backup&gt;</h7>
    
<ul class="alternate "><li class=" ">            <p>
    <tt class=" ">strategy</tt> This attribute configures the backup strategy for this cache. Allowable values are SYNC, ASYNC.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">failure-policy</tt> This attribute configures the policy to follow when connectivity to the backup site fails. Allowable values are IGNORE, WARN, FAIL, CUSTOM.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">enabled</tt> This attribute configures whether or not this backup is enabled. If enabled, data will be sent to the backup site; otherwise, the backup site will be effectively ignored.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">timeout</tt> This attribute configures the time-out for replicating to the backup site.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">after-failures</tt> This attribute configures the number of failures after which this backup site should go off-line.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">min-wait</tt> This attribute configures the minimum time (in milliseconds) to wait after the max number of failures is reached, after which this backup site should go off-line.            </p>
    </li></ul>    </div>
    
    <div class="section-7"  id="66322833_HighAvailabilityGuide-%3Cbackupfor%3E"  >
        <h7>&lt;backup-for&gt;</h7>
    
<ul class="alternate "><li class=" ">            <p>
    <tt class=" ">remote-cache</tt> This attribute configures the name of the remote cache for which this cache acts as a backup.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">remote-site</tt> This attribute configures the site of the remote cache for which this cache acts as a backup.            </p>
    </li></ul>    </div>
    
    </div>
    
    <div class="section-6"  id="66322833_HighAvailabilityGuide-%3Creplicatedcache%3Eextends%3Cabstractsharedcache%3E"  >
        <h6>&lt;replicated-cache&gt; extends &lt;abstract shared-cache&gt;</h6>
    
            <p>
    This element configures a replicated cache. With a replicated cache, all contents (key-value pairs) of the cache are replicated on all nodes in the cluster.            </p>
        </div>
    
    <div class="section-6"  id="66322833_HighAvailabilityGuide-%3Cdistributedcache%3Eextends%3Cabstractsharedcache%3E"  >
        <h6>&lt;distributed-cache&gt; extends &lt;abstract shared-cache&gt;</h6>
    
            <p>
    This element configures a distributed cache. With a distributed cache, contents of the cache are selectively replicated on nodes in the cluster, according to the number of owners specified.            </p>
    <ul class="alternate "><li class=" ">            <p>
    <tt class=" ">owners</tt> This attribute configures the number of cluster-wide replicas for each cache entry.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">segments</tt> This attribute configures the number of hash space segments which is the granularity for key distribution in the cluster. Value must be strictly positive.            </p>
    </li><li class=" ">            <p>
    <tt class=" ">l1-lifespan</tt> This attribute configures the maximum lifespan of an entry placed in the L1 cache. Configures the L1 cache behaviour in 'distributed' caches instances. In any other cache modes, this element is ignored.            </p>
    </li></ul>    </div>
    
    </div>
    
    </div>
    
    <div class="section-4"  id="66322833_HighAvailabilityGuide-UseCases2"  >
        <h4>Use Cases</h4>
    
            <p>
    In many cases, cache containers and caches will be configured via XML as in the example above, so that they will be available upon server start-up. However, cache containers and caches may also be added, removed or have their configurations changed in a running server by making use of the Wildfly management API command-line interface (CLI).&nbsp;In this section, we present some key use cases for the Infinispan management API.            </p>
                <p>
    The key use cases covered are:            </p>
    <ul class="alternate "><li class=" ">            <p>
    adding a cache container            </p>
    </li><li class=" ">            <p>
    adding a cache to an existing cache container            </p>
    </li><li class=" ">            <p>
    configuring the transaction subsystem of a cache            </p>
        <div class="confbox admonition admonition-note">
        
            <p>
    The Wildfly management API command-line interface (CLI) can be used to provide extensive information on the attributes and commands available in the Infinispan subsystem interface used in these examples.            </p>
        </div>
    
</li></ul>    <div class="section-5"  id="66322833_HighAvailabilityGuide-Addacachecontainer"  >
        <h5>Add a cache container</h5>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre><code>/subsystem=infinispan/cache-container=mycontainer:add(default-cache=&lt;default-cache-name&gt;)
/subsystem=infinispan/cache-container=mycontainer/transport=TRANSPORT:add(lock-timeout=&lt;timeout&gt;)</code></pre>
        </div>
    </div>
    </div>
    
    <div class="section-5"  id="66322833_HighAvailabilityGuide-Addacache"  >
        <h5>Add a cache</h5>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre><code>/subsystem=infinispan/cache-container=mycontainer/local-cache=mylocalcache:add()</code></pre>
        </div>
    </div>
    </div>
    
    <div class="section-5"  id="66322833_HighAvailabilityGuide-Configurethetransactioncomponentofacache"  >
        <h5>Configure the transaction component of a cache</h5>
    
    <div class="confbox programlisting">
                <div class="content">
        <pre><code>/subsystem=infinispan/cache-container=mycontainer/local-cache=mylocalcache/transaction=TRANSACTION:add(mode=&lt;transaction-mode&gt;)</code></pre>
        </div>
    </div>
    </div>
    
    </div>
    
    </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-ClusteredWebSessions"  >
        <h3>Clustered Web Sessions</h3>
    
    </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-ClusteredSSO"  >
        <h3>Clustered SSO</h3>
    
    </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-LoadBalancing"  >
        <h3>Load Balancing</h3>
    
            <p>
    This section describes load balancing via Apache + mod_jk and Apache + mod_cluster.            </p>
        </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-LoadbalancingwithApachemodjk"  >
        <h3>Load balancing with Apache + mod_jk</h3>
    
            <p>
    Describe load balancing with Apache using mod_jk.            </p>
        </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-LoadbalancingwithApachemodcluster"  >
        <h3>Load balancing with Apache + mod_cluster</h3>
    
            <p>
    Describe load balancing with Apache using mod_cluster.            </p>
        <div class="section-4"  id="66322833_HighAvailabilityGuide-modclusterSubsystem"  >
        <h4>mod_cluster Subsystem</h4>
    
            <p>
    The mod_cluster integration is done via the <a href="http://docs.jboss.org/mod_cluster/1.1.0/html/java.AS7config.html">modcluster subsystem</a> it requires mod_cluster-1.1.x.or mod_cluster-1.2.x (since 7.1.0)            </p>
                <p>
    The modcluster subsystem supports several operations:            </p>
                <p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>[standalone@localhost:9999 subsystem=modcluster] :read-operation-names
{
    &quot;outcome&quot; =&gt; &quot;success&quot;,
    &quot;result&quot; =&gt; [
        &quot;add&quot;,
        &quot;add-custom-metric&quot;,
        &quot;add-metric&quot;,
        &quot;add-proxy&quot;,
        &quot;disable&quot;,
        &quot;disable-context&quot;,
        &quot;enable&quot;,
        &quot;enable-context&quot;,
        &quot;list-proxies&quot;,
        &quot;read-attribute&quot;,
        &quot;read-children-names&quot;,
        &quot;read-children-resources&quot;,
        &quot;read-children-types&quot;,
        &quot;read-operation-description&quot;,
        &quot;read-operation-names&quot;,
        &quot;read-proxies-configuration&quot;,
        &quot;read-proxies-info&quot;,
        &quot;read-resource&quot;,
        &quot;read-resource-description&quot;,
        &quot;refresh&quot;,
        &quot;remove-custom-metric&quot;,
        &quot;remove-metric&quot;,
        &quot;remove-proxy&quot;,
        &quot;reset&quot;,
        &quot;stop&quot;,
        &quot;stop-context&quot;,
        &quot;validate-address&quot;,
        &quot;write-attribute&quot;
    ]
}</code></pre>
        </div>
    </div>
The operations specific to the modcluster subsystem are divided in 3 categories the ones that affects the configuration and require a restart of the subsystem, the one that just modify the behaviour temporarily and the ones that display information from the httpd part.            </p>
        <div class="section-5"  id="66322833_HighAvailabilityGuide-operationsdisplayinghttpdinformations"  >
        <h5>operations displaying httpd informations</h5>
    
            <p>
    There are 2 operations that display how Apache httpd sees the node:            </p>
        <div class="section-6"  id="66322833_HighAvailabilityGuide-readproxiesconfiguration"  >
        <h6>read-proxies-configuration</h6>
    
            <p>
    Send a DUMP message to all Apache httpd the node is connected to and display the message received from Apache httpd.            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>[standalone@localhost:9999 subsystem=modcluster] :read-proxies-configuration
{
    &quot;outcome&quot; =&gt; &quot;success&quot;,
    &quot;result&quot; =&gt; [
        &quot;neo3:6666&quot;,
        &quot;balancer: [1] Name: mycluster Sticky: 1 [JSESSIONID]/[jsessionid] remove: 0 force: 1 Timeout: 0 Maxtry: 1
node: [1:1],Balancer: mycluster,JVMRoute: 498bb1f0-00d9-3436-a341-7f012bc2e7ec,Domain: [],Host: 127.0.0.1,Port: 8080,Type: http,flushpackets: 0,flushwait: 10,ping: 10,smax: 26,ttl: 60,timeout: 0
host: 1 [example.com] vhost: 1 node: 1
host: 2 [localhost] vhost: 1 node: 1
host: 3 [default-host] vhost: 1 node: 1
context: 1 [/myapp] vhost: 1 node: 1 status: 1
context: 2 [/] vhost: 1 node: 1 status: 1
&quot;,
        &quot;jfcpc:6666&quot;,
        &quot;balancer: [1] Name: mycluster Sticky: 1 [JSESSIONID]/[jsessionid] remove: 0 force: 1 Timeout: 0 maxAttempts: 1
node: [1:1],Balancer: mycluster,JVMRoute: 498bb1f0-00d9-3436-a341-7f012bc2e7ec,LBGroup: [],Host: 127.0.0.1,Port: 8080,Type: http,flushpackets: 0,flushwait: 10,ping: 10,smax: 26,ttl: 60,timeout: 0
host: 1 [default-host] vhost: 1 node: 1
host: 2 [localhost] vhost: 1 node: 1
host: 3 [example.com] vhost: 1 node: 1
context: 1 [/] vhost: 1 node: 1 status: 1
context: 2 [/myapp] vhost: 1 node: 1 status: 1
&quot;
    ]
}</code></pre>
        </div>
    </div>
    </div>
    
    <div class="section-6"  id="66322833_HighAvailabilityGuide-readproxiesinfo"  >
        <h6>read-proxies-info</h6>
    
            <p>
    Send a INFO message to all Apache httpd the node is connected to and display the message received from Apache httpd.            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>[standalone@localhost:9999 subsystem=modcluster] :read-proxies-info
{
    &quot;outcome&quot; =&gt; &quot;success&quot;,
    &quot;result&quot; =&gt; [
        &quot;neo3:6666&quot;,
        &quot;Node: [1],Name: 498bb1f0-00d9-3436-a341-7f012bc2e7ec,Balancer: mycluster,Domain: ,Host: 127.0.0.1,Port: 8080,Type: http,Flushpackets: Off,Flushwait: 10000,Ping: 10000000,Smax: 26,Ttl: 60000000,Elected: 0,Read: 0,Transfered: 0,Connected: 0,Load: -1
Vhost: [1:1:1], Alias: example.com
Vhost: [1:1:2], Alias: localhost
Vhost: [1:1:3], Alias: default-host
Context: [1:1:1], Context: /myapp, Status: ENABLED
Context: [1:1:2], Context: /, Status: ENABLED
&quot;,
        &quot;jfcpc:6666&quot;,
        &quot;Node: [1],Name: 498bb1f0-00d9-3436-a341-7f012bc2e7ec,Balancer: mycluster,LBGroup: ,Host: 127.0.0.1,Port: 8080,Type: http,Flushpackets: Off,Flushwait: 10,Ping: 10,Smax: 26,Ttl: 60,Elected: 0,Read: 0,Transfered: 0,Connected: 0,Load: 1
Vhost: [1:1:1], Alias: default-host
Vhost: [1:1:2], Alias: localhost
Vhost: [1:1:3], Alias: example.com
Context: [1:1:1], Context: /, Status: ENABLED
Context: [1:1:2], Context: /myapp, Status: ENABLED
&quot;
    ]
}</code></pre>
        </div>
    </div>
    </div>
    
    </div>
    
    <div class="section-5"  id="66322833_HighAvailabilityGuide-3"  >
        <h5></h5>
    
    <div class="section-6"  id="66322833_HighAvailabilityGuide-operationsthathandletheproxiesthenodeisconnectedtoo"  >
        <h6>operations that handle the proxies the node is connected too</h6>
    
            <p>
    there are 3 operation that could be used to manipulate the list of Apache httpd the node is connected too.            </p>
        </div>
    
    <div class="section-6"  id="66322833_HighAvailabilityGuide-listproxies%3A"  >
        <h6>list-proxies:</h6>
    
            <p>
    Displays the httpd that are connected to the node. The httpd could be discovered via the Advertise protocol or via the proxy-list attribute.            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>[standalone@localhost:9999 subsystem=modcluster] :list-proxies
{
    &quot;outcome&quot; =&gt; &quot;success&quot;,
    &quot;result&quot; =&gt; [
        &quot;neo3:6666&quot;,
        &quot;jfcpc:6666&quot;
    ]
}</code></pre>
        </div>
    </div>
    </div>
    
    <div class="section-6"  id="66322833_HighAvailabilityGuide-removeproxy"  >
        <h6>remove-proxy</h6>
    
            <p>
    Remove a proxy from the discovered proxies or&nbsp; temporarily from the proxy-list attribute.            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>[standalone@localhost:9999 subsystem=modcluster] :remove-proxy(host=jfcpc, port=6666)
{&quot;outcome&quot; =&gt; &quot;success&quot;}</code></pre>
        </div>
    </div>
    </div>
    
    <div class="section-6"  id="66322833_HighAvailabilityGuide-addproxy"  >
        <h6>proxy</h6>
    
            <p>
    Add a proxy to the discovered proxies or&nbsp; temporarily to the proxy-list attribute.            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>[standalone@localhost:9999 subsystem=modcluster] :add-proxy(host=jfcpc, port=6666)
{&quot;outcome&quot; =&gt; &quot;success&quot;}</code></pre>
        </div>
    </div>
    </div>
    
    </div>
    
    <div class="section-5"  id="66322833_HighAvailabilityGuide-Contextrelatedoperations"  >
        <h5>Context related operations</h5>
    
            <p>
    Those operations allow to send context related commands to Apache httpd. They are send automatically when deploying or undeploying&nbsp; webapps.            </p>
        <div class="section-6"  id="66322833_HighAvailabilityGuide-enablecontext"  >
        <h6>enable-context</h6>
    
            <p>
    Tell Apache httpd that the context is ready receive requests.            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>[standalone@localhost:9999 subsystem=modcluster] :enable-context(context=/myapp, virtualhost=default-host)
{&quot;outcome&quot; =&gt; &quot;success&quot;}</code></pre>
        </div>
    </div>
    </div>
    
    <div class="section-6"  id="66322833_HighAvailabilityGuide-disablecontext"  >
        <h6>disable-context</h6>
    
            <p>
    Tell Apache httpd that it shouldn't send new session requests to the context of the virtualhost.            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>[standalone@localhost:9999 subsystem=modcluster] :disable-context(context=/myapp, virtualhost=default-host)
{&quot;outcome&quot; =&gt; &quot;success&quot;}</code></pre>
        </div>
    </div>
    </div>
    
    <div class="section-6"  id="66322833_HighAvailabilityGuide-stopcontext"  >
        <h6>stop-context</h6>
    
            <p>
    Tell Apache httpd that it shouldn't send requests to the context of the virtualhost.            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>[standalone@localhost:9999 subsystem=modcluster] :stop-context(context=/myapp, virtualhost=default-host, waittime=50)
{&quot;outcome&quot; =&gt; &quot;success&quot;}</code></pre>
        </div>
    </div>
    </div>
    
    </div>
    
    <div class="section-5"  id="66322833_HighAvailabilityGuide-Noderelatedoperations"  >
        <h5>Node related operations</h5>
    
            <p>
    Those operations are like the context operation but they apply to all webapps running on the node and operation that affect the whole node.            </p>
        <div class="section-6"  id="66322833_HighAvailabilityGuide-refresh"  >
        <h6>refresh</h6>
    
            <p>
    Refresh the node by sending a new CONFIG message to Apache httpd.            </p>
        </div>
    
    <div class="section-6"  id="66322833_HighAvailabilityGuide-reset"  >
        <h6>reset</h6>
    
            <p>
    reset the connection between Apache httpd and the node            </p>
        </div>
    
    </div>
    
    <div class="section-5"  id="66322833_HighAvailabilityGuide-Configuration"  >
        <h5>Configuration</h5>
    
    <div class="section-6"  id="66322833_HighAvailabilityGuide-Metricconfiguration"  >
        <h6>Metric configuration</h6>
    
            <p>
    There are 4 metric operations corresponding to add and remove load metrics to the dynamic-load-provider. Note that when nothing is defined a simple-load-provider is use with a fixed load factor of one.            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>[standalone@localhost:9999 subsystem=modcluster] :read-resource(name=mod-cluster-config)
{
    &quot;outcome&quot; =&gt; &quot;success&quot;,
    &quot;result&quot; =&gt; {&quot;simple-load-provider&quot; =&gt; {&quot;factor&quot; =&gt; &quot;1&quot;}}
}</code></pre>
        </div>
    </div>
            <p>
    that corresponds to the following configuration:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;subsystem xmlns=&quot;urn:jboss:domain:modcluster:1.0&quot;&gt;
            &lt;mod-cluster-config&gt;
                &lt;simple-load-provider factor=&quot;1&quot;/&gt;
            &lt;/mod-cluster-config&gt;
 &lt;/subsystem&gt;</code></pre>
        </div>
    </div>
    <div class="section-7"  id="66322833_HighAvailabilityGuide-addmetric"  >
        <h7>metric</h7>
    
            <p>
    Add a metric to the dynamic-load-provider, the dynamic-load-provider in configuration is created if needed.            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>[standalone@localhost:9999 subsystem=modcluster] :add-metric(type=cpu)
{&quot;outcome&quot; =&gt; &quot;success&quot;}
[standalone@localhost:9999 subsystem=modcluster] :read-resource(name=mod-cluster-config)
{
    &quot;outcome&quot; =&gt; &quot;success&quot;,
    &quot;result&quot; =&gt; {
        &quot;dynamic-load-provider&quot; =&gt; {
            &quot;history&quot; =&gt; 9,
            &quot;decay&quot; =&gt; 2,
            &quot;load-metric&quot; =&gt; [{
                &quot;type&quot; =&gt; &quot;cpu&quot;
            }]
        }
    }
}</code></pre>
        </div>
    </div>
    </div>
    
    <div class="section-7"  id="66322833_HighAvailabilityGuide-removemetric"  >
        <h7>remove-metric</h7>
    
            <p>
    Remove a metric from the dynamic-load-provider.            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>[standalone@localhost:9999 subsystem=modcluster] :remove-metric(type=cpu)
{&quot;outcome&quot; =&gt; &quot;success&quot;}</code></pre>
        </div>
    </div>
    </div>
    
    <div class="section-7"  id="66322833_HighAvailabilityGuide-addcustommetric%2Fremovecustommetric"  >
        <h7>custom-metric / remove-custom-metric</h7>
    
            <p>
    like the add-metric and remove-metric except they require a class parameter instead the type. Usually they needed additional properties which can be specified            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>[standalone@localhost:9999 subsystem=modcluster] :add-custom-metric(class=myclass, property=[(&quot;pro1&quot; =&gt; &quot;value1&quot;), (&quot;pro2&quot; =&gt; &quot;value2&quot;)]
{&quot;outcome&quot; =&gt; &quot;success&quot;}</code></pre>
        </div>
    </div>
            <p>
    which corresponds the following in the xml configuration file:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;subsystem xmlns=&quot;urn:jboss:domain:modcluster:1.0&quot;&gt;
            &lt;mod-cluster-config&gt;
                &lt;dynamic-load-provider history=&quot;9&quot; decay=&quot;2&quot;&gt;
                    &lt;custom-load-metric class=&quot;myclass&quot;&gt;
                        &lt;property name=&quot;pro1&quot; value=&quot;value1&quot;/&gt;
                        &lt;property name=&quot;pro2&quot; value=&quot;value2&quot;/&gt;
                    &lt;/custom-load-metric&gt;
                &lt;/dynamic-load-provider&gt;
            &lt;/mod-cluster-config&gt;
&lt;/subsystem&gt;</code></pre>
        </div>
    </div>
    </div>
    
    </div>
    
    <div class="section-6"  id="66322833_HighAvailabilityGuide-JVMRouteconfiguration"  >
        <h6>JVMRoute configuration</h6>
    
            <p>
    If you want to use your own JVM route instead of automatically generated one you can insert the following property:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>...
&lt;/extensions&gt;
&lt;system-properties&gt;
   &lt;property name=&quot;jboss.mod_cluster.jvmRoute&quot; value=&quot;myJvmRoute&quot;/&gt;
&lt;/system-properties&gt;
&lt;management&gt;
...</code></pre>
        </div>
    </div>
    </div>
    
    </div>
    
    </div>
    
    </div>
    
    </div>
    
    <div class="section-2"  id="66322833_HighAvailabilityGuide-EJBServices"  >
        <h2>EJB Services</h2>
    
            <p>
    This chapter explains how clustering of EJBs works in WildFly 8.            </p>
        <div class="section-3"  id="66322833_HighAvailabilityGuide-EJBSubsystem"  >
        <h3>EJB Subsystem</h3>
    
    </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-MarkinganEJBasclustered"  >
        <h3>Marking an EJB as clustered</h3>
    
            <p>
    WildFly 8 allows clustering of stateful session beans. A stateful session bean can be marked with <tt class=" ">@org.jboss.ejb3.annotation.Clustered</tt> annotation or be marked as clustered using the jboss-ejb3.xml's <tt class=" ">&lt;clustered&gt;</tt> element.            </p>
        <div class="confbox programlisting">
                    <div class="title">MyStatefulBean</div>
                <div class="content">
        <pre><code>import org.jboss.ejb3.annotation.Clustered;
import javax.ejb.Stateful;

@Stateful
@Clustered
public class MyStatefulBean {
...
}</code></pre>
        </div>
    </div>
    <div class="confbox programlisting">
                    <div class="title">jboss-ejb3.xml</div>
                <div class="content">
        <pre><code>&lt;jboss xmlns=&quot;http://www.jboss.com/xml/ns/javaee&quot;
       xmlns:jee=&quot;http://java.sun.com/xml/ns/javaee&quot;
       xmlns:c=&quot;urn:clustering:1.0&quot;&gt;


    &lt;jee:assembly-descriptor&gt;
        &lt;c:clustering&gt;
            &lt;jee:ejb-name&gt;DDBasedClusteredBean&lt;/jee:ejb-name&gt;
            &lt;c:clustered&gt;true&lt;/c:clustered&gt;
        &lt;/c:clustering&gt;
    &lt;/jee:assembly-descriptor&gt;
&lt;/jboss&gt;</code></pre>
        </div>
    </div>
    </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-DeployingclusteredEJBs"  >
        <h3>Deploying clustered EJBs</h3>
    
            <p>
    Clustering support is available in the HA profiles of WildFly 8. In this chapter we'll be using the standalone server for explaining the details. However, the same applies to servers in a domain mode. Starting the standalone server with HA capabilities enabled, involves starting it with the standalone-ha.xml (or even standalone-full-ha.xml):            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>./standalone.sh -server-config=standalone-ha.xml</code></pre>
        </div>
    </div>
            <p>
    This will start a single instance of the server with HA capabilities. Deploying the EJBs to this instance <i class=" ">doesn't</i> involve anything special and is the same as explained in the <a href="https://docs.jboss.org/author/display/AS71/Application+deployment">application deployment chapter</a>.            </p>
                <p>
    Obviously, to be able to see the benefits of clustering, you'll need more than one instance of the server. So let's start another server with HA capabilities. That another instance of the server can either be on the same machine or on some other machine. If it's on the same machine, the two things you have to make sure is that you pass the port offset for the second instance and also make sure that each of the server instances have a unique <tt class=" ">jboss.node.name</tt> system property. You can do that by passing the following two system properties to the startup command:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>./standalone.sh -server-config=standalone-ha.xml -Djboss.socket.binding.port-offset=&lt;offset of your choice&gt; -Djboss.node.name=&lt;unique node name&gt;</code></pre>
        </div>
    </div>
            <p>
    Follow whichever approach you feel comfortable with for deploying the EJB deployment to this instance too.            </p>
        <div class="confbox admonition admonition-note">
        
            <p>
    Deploying the application on just one node of a standalone instance of a clustered server does <strong class=" ">not</strong> mean that it will be automatically deployed to the other clustered instance. You will have to do deploy it explicitly on the other standalone clustered instance too. Or you can start the servers in domain mode so that the deployment can be deployed to all the server within a server group. See the <a href="https://docs.jboss.org/author/display/AS71/Admin+Guide">admin guide</a> for more details on domain setup.            </p>
        </div>
    
            <p>
    Now that you have deployed an application with clustered EJBs on both the instances, the EJBs are now capable of making use of the clustering features.            </p>
        </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-FailoverforclusteredEJBs"  >
        <h3>Failover for clustered EJBs</h3>
    
            <p>
    Clustered EJBs have failover capability. The state of the @Stateful @Clustered EJBs is replicated across the cluster nodes so that if one of the nodes in the cluster goes down, some other node will be able to take over the invocations. Let's see how it's implemented in WildFly 8. In the next few sections we'll see how it works for remote (standalone) clients and for clients in another remote WildFly server instance. Although, there isn't a difference in how it works in both these cases, we'll still explain it separately so as to make sure there aren't any unanswered questions.            </p>
        <div class="section-4"  id="66322833_HighAvailabilityGuide-Remotestandaloneclients"  >
        <h4>Remote standalone clients</h4>
    
            <p>
    In this section we'll consider a remote standalone client (i.e. a client which runs in a separate JVM and <i class=" ">isn't</i> running within another WildFly 8 instance). Let's consider that we have 2 servers, server X and server Y which we started earlier. Each of these servers has the clustered EJB deployment. A standalone remote client can use either the <a href="https://docs.jboss.org/author/display/AS71/EJB+invocations+from+a+remote+client+using+JNDI">JNDI approach</a> or native JBoss EJB client APIs to communicate with the servers. The important thing to note is that when you are invoking clustered EJB deployments, you do <strong class=" ">not</strong> have to list all the servers within the cluster (which obviously wouldn't have been feasible due the dynamic nature of cluster node additions within a cluster).            </p>
                <p>
    The remote client just has to list only one of the servers with the clustering capability. In this case, we can either list server X (in jboss-ejb-client.properties) <i class=" ">or</i> server Y. This server will act as the starting point for cluster topology communication between the client and the clustered nodes.            </p>
                <p>
    Note that you have to configure the <i class=" ">ejb</i> cluster in the jboss-ejb-client.properties configuration file, like so:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>remote.clusters=ejb
remote.cluster.ejb.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false
remote.cluster.ejb.connect.options.org.xnio.Options.SSL_ENABLED=false</code></pre>
        </div>
    </div>
    </div>
    
    <div class="section-4"  id="66322833_HighAvailabilityGuide-Clustertopologycommunication"  >
        <h4>Cluster topology communication</h4>
    
            <p>
    When a client connects to a server, the JBoss EJB client implementation (internally) communicates with the server for cluster topology information, if the server had clustering capability. In our example above, let's assume we listed server X as the initial server to connect to. When the client connects to server X, the server will send back an (asynchronous) cluster topology message to the client. This topology message consists of the cluster name(s) and the information of the nodes that belong to the cluster. The node information includes the node address and port number to connect to (whenever necessary). So in this example, the server X will send back the cluster topology consisting of the other server Y which belongs to the cluster.            </p>
                <p>
    In case of stateful (clustered) EJBs, a typical invocation flow involves creating of a session for the stateful bean, which happens when you do a JNDI lookup for that bean, and then invoking on the returned proxy. The lookup for stateful bean, internally, triggers a (synchronous) session creation request from the client to the server. In this case, the session creation request goes to server X since that's the initial connection that we have configured in our jboss-ejb-client.properties. Since server X is clustered, it will return back a session id and along with send back an <i class=" ">&quot;affinity&quot;</i> of that session. In case of clustered servers, the affinity equals to the name of the cluster to which the stateful bean belongs on the server side. For non-clustered beans, the affinity is just the node name on which the session was created. This <i class=" ">affinity</i> will later help the EJB client to route the invocations on the proxy, appropriately to either a node within a cluster (for clustered beans) or to a specific node (for non-clustered beans). While this session creation request is going on, the server X will also send back an asynchronous message which contains the cluster topology. The JBoss EJB client implementation will take note of this topology information and will later use it for connection creation to nodes within the cluster and routing invocations to those nodes, whenever necessary.            </p>
                <p>
    Now that we know how the cluster topology information is communicated from the server to the client, let see how failover works. Let's continue with the example of server X being our starting point and a client application looking up a stateful bean and invoking on it. During these invocations, the client side will have collected the cluster topology information from the server. Now let's assume for some reason, server X goes down and the client application subsequent invokes on the proxy. The JBoss EJB client implementation, at this stage will be aware of the affinity and in this case it's a cluster affinity. Because of the cluster topology information it has, it knows that the cluster has two nodes server X and server Y. When the invocation now arrives, it sees that the server X is down. So it uses a selector to fetch a suitable node from among the cluster nodes. The selector itself is configurable, but we'll leave it from discussion for now. When the selector returns a node from among the cluster, the JBoss EJB client implementation creates a connection to that node (if not already created earlier) and creates a EJB receiver out of it. Since in our example, the only other node in the cluster is server Y, the selector will return that node and the JBoss EJB client implementation will use it to create a EJB receiver out of it and use that receiver to pass on the invocation on the proxy. Effectively, the invocation has now failed over to a different node within the cluster.            </p>
        </div>
    
    <div class="section-4"  id="66322833_HighAvailabilityGuide-RemoteclientsonanotherinstanceofWildFly8"  >
        <h4>Remote clients on another instance of WildFly 8</h4>
    
            <p>
    So far we discussed remote standalone clients which typically use either the EJB client API or the jboss-ejb-client.properties based approach to configure and communicate with the servers where the clustered beans are deployed. Now let's consider the case where the client is an application deployed another AS7 instance and it wants to invoke on a clustered stateful bean which is deployed on another instance of WildFly 8. In this example let's consider a case where we have 3 servers involved.  Server X and Server Y both belong to a cluster and have clustered EJB  deployed on them. Let's consider another server instance Server C (which may or may <i class=" ">not</i> have clustering capability) which  acts as a client on which there's a deployment which wants to invoke on  the clustered beans deployed on server X and Y and achieve failover.            </p>
                <p>
    The configurations required to achieve this are explained in <a href="https://docs.jboss.org/author/display/WFLY8/EJB+invocations+from+a+remote+server+instance">this chapter</a>. As you can see the configurations are done in a jboss-ejb-client.xml which points to a remote outbound connection to the other server. This jboss-ejb-client.xml goes in the deployment of server C (since that's our client). As explained eariler, the client configuration need <strong class=" ">not</strong> point to all clustered nodes. Instead it just has to point to one of them which will act as a start point for communication. So in this case, we can create a remote outbound connection on server C to server X and use server X as our starting point for communication. Just like in the case of remote standalone clients, when the application on server C (client) looks up a stateful bean, a session creation request will be sent to server X which will send back a session id and the cluster affinity for it. Furthermore, server X asynchronously send back a message to server C (client) containing the cluster topology. This topology information will include the node information of server Y (since that belongs to the cluster along with server X).&nbsp; Subsequent invocations on the proxy will be routed appropriately to the nodes in the cluster. If server X goes down, as explained earlier, a different node from the cluster will be selected and the invocation will be forwarded to that node.            </p>
                <p>
    As can be seen both remote standalone client and remote clients on another WildFly 8 instance act similar in terms of failover.            </p>
        </div>
    
    <div class="section-4"  id="66322833_HighAvailabilityGuide-Testcasesforfailoverofstatefulbeans"  >
        <h4>Testcases for failover of stateful beans</h4>
    
            <p>
    We have testcases in WildFly 8 testsuite which test that whatever is explained above works as expected. The <a href="https://github.com/wildfly/wildfly/blob/master/testsuite/integration/clust/src/test/java/org/jboss/as/test/clustering/cluster/ejb3/stateful/remote/failover/RemoteEJBClientStatefulBeanFailoverTestCase.java">RemoteEJBClientStatefulBeanFailoverTestCase</a> tests the case where a stateful EJB uses @Clustered annotation to mark itself as clustered. We also have <a href="https://github.com/wildfly/wildfly/blob/master/testsuite/integration/clust/src/test/java/org/jboss/as/test/clustering/cluster/ejb3/stateful/remote/failover/dd/RemoteEJBClientDDBasedSFSBFailoverTestCase.java">RemoteEJBClientDDBasedSFSBFailoverTestCase</a> which uses jboss-ejb3.xml to mark a stateful EJB as clustered. Both these testcases test that when a node goes down in a cluster, the client invocation is routed to a different node in the cluster.            </p>
        </div>
    
    </div>
    
    </div>
    
    <div class="section-2"  id="66322833_HighAvailabilityGuide-Hibernate"  >
        <h2>Hibernate</h2>
    
    </div>
    
    <div class="section-2"  id="66322833_HighAvailabilityGuide-RelatedIssues"  >
        <h2>Related Issues</h2>
    
            <p>
    This section describes additional issues related to the clustering subsystems.            </p>
        <div class="section-3"  id="66322833_HighAvailabilityGuide-ModularityAndClassLoading"  >
        <h3>Modularity And Class Loading</h3>
    
            <p>
    Describe classloading and monitoring framework as it affects clustering applications.            </p>
        </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-Monitoring"  >
        <h3>Monitoring</h3>
    
            <p>
    Describe resources available for monitoring clustered applications.            </p>
        </div>
    
    </div>
    
    <div class="section-2"  id="66322833_HighAvailabilityGuide-ChangesFromPreviousVersions"  >
        <h2>Changes From Previous Versions</h2>
    
            <p>
    Describe here key changes between releases.            </p>
        <div class="section-3"  id="66322833_HighAvailabilityGuide-Keychanges"  >
        <h3>Key changes</h3>
    
    </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-MigrationtoWildfly"  >
        <h3>Migration to Wildfly</h3>
    
    </div>
    
    </div>
    
    <div class="section-2"  id="66322833_HighAvailabilityGuide-WildFly8DomainClusterHowto"  >
        <h2>WildFly 8 Domain Cluster Howto</h2>
    
<ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Preparation%26Scenario">Preparation &amp; Scenario</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Preparation">Preparation</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Scenario">Scenario</a>            </p>
    </li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-DownloadWildFly8">Download WildFly 8</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-DomainConfiguration">Domain Configuration</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Interfaceconfigonmaster">Interface config on master</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Interfaceconfigonslave">Interface config on slave</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-SecurityConfiguration">Security Configuration</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Master">Master</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Slave">Slave</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-DryRun">Dry Run</a>            </p>
    </li></ul></li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Deployment">Deployment</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-ClusterConfiguration">Cluster Configuration</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Testing">Testing</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-SpecialThanks">Special Thanks</a>            </p>
    </li></ul>            <p>
    In this article, I'd like to show you how to setup WildFly 8 in domain mode and enable clustering so we could get HA and session replication among the nodes. It's a step to step guide so you can follow the instructions in this article and build the sandbox by yourself     <img src="images/author/images/icons/emoticons/109556488.gif" alt="images/author/images/icons/emoticons/109556488.gif" />
            </p>
        <div class="section-3"  id="66322833_HighAvailabilityGuide-Preparation%26Scenario"  >
        <h3>Preparation &amp; Scenario</h3>
    
    <div class="section-4"  id="66322833_HighAvailabilityGuide-Preparation"  >
        <h4>Preparation</h4>
    
            <p>
    We need to prepare two hosts (or virtual hosts) to do the experiment. We will use these two hosts as following:            </p>
    <ul class="alternate "><li class=" ">            <p>
    Install Fedora 16 on them (Other linux version may also fine but I'll use Fedora 16 in this article)            </p>
    </li></ul><ul class="alternate "><li class=" ">            <p>
    Make sure that they are in same local network            </p>
    </li></ul><ul class="alternate "><li class=" ">            <p>
    Make sure that they can access each other via different TCP/UDP ports(better turn off firewall and disable SELinux during the experiment or they will cause network problems).            </p>
    </li></ul>    </div>
    
    <div class="section-4"  id="66322833_HighAvailabilityGuide-Scenario"  >
        <h4>Scenario</h4>
    
            <p>
    Here are some details on what we are going to do:            </p>
    <ul class="alternate "><li class=" ">            <p>
    Let's call one host as 'master', the other one as 'slave'.            </p>
    </li></ul><ul class="alternate "><li class=" ">            <p>
    Both master and slave will run WildFly 8, and master will run as domain controller, slave will under the domain management of master.            </p>
    </li></ul><ul class="alternate "><li class=" ">            <p>
    Apache httpd will be run on master, and in httpd we will enable the mod_cluster module. The WildFly 8 on master and slave will form a cluster and discovered by httpd.            </p>
    </li></ul>            <p>
        <img src="images/author/download/attachments/66322836/-2061211704.jpg" alt="images/author/download/attachments/66322836/-2061211704.jpg" />
                </p>
    <ul class="alternate "><li class=" ">            <p>
    We will deploy a demo project into domain, and verify that the project is deployed into both master and slave by domain controller. Thus we could see that domain management provide us a single point to manage the deployments across multiple hosts in a single domain.            </p>
    </li></ul><ul class="alternate "><li class=" ">            <p>
    We will access the cluster URL and verify that httpd has distributed the request to one of the WildFly host. So we could see the cluster is working properly.            </p>
    </li></ul><ul class="alternate "><li class=" ">            <p>
    We will try to make a request on cluster, and if the request is forwarded to master, we then kill the WildFly process on master. After that we will go on requesting cluster and we should see the request is forwarded to slave, but the session is not lost. Our goal is to verify the HA is working and sessions are replicated.            </p>
    </li></ul><ul class="alternate "><li class=" ">            <p>
    After previous step finished, we reconnect the master by restarting it. We should see the master is registered back into cluster, also we should see slave sees master as domain controller again and connect to it.            </p>
    </li></ul>            <p>
        <img src="images/author/download/attachments/66322836/-2019335011.jpg" alt="images/author/download/attachments/66322836/-2019335011.jpg" />
                </p>
                <p>
    Please don't worry if you cannot digest so many details currently. Let's move on and you will get the points step by step.            </p>
        </div>
    
    </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-DownloadWildFly8"  >
        <h3>Download WildFly 8</h3>
    
            <p>
    First we should download WildFly 8 from the website:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>http://www.jboss.org/jbossas/downloads/</code></pre>
        </div>
    </div>
            <p>
    The version I downloaded is JBoss AS 7.1.0.CR1b, please don't use the version prior to this one, or you will meet this bug when running in clustering mode:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>https://issues.jboss.org/browse/AS7-2738</code></pre>
        </div>
    </div>
            <p>
    After download finished, I got the zip file:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>jboss-as-7.1.0.CR1b.zip</code></pre>
        </div>
    </div>
            <p>
    Note: The name of your archive will differ slightly due to version naming conventions.<br/>Then I unzipped the package to master and try to make a test run:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>unzip jboss-as-7.1.0.CR1b.zip
cd jboss-as-7.1.0.CR1b/bin
./domain.sh</code></pre>
        </div>
    </div>
            <p>
    If everything ok we should see WildFly successfully startup in domain mode:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>jboss-as-7.1.0.CR1b/bin$ ./domain.sh
=========================================================================

  JBoss Bootstrap Environment

  JBOSS_HOME: /Users/weli/Downloads/jboss-as-7.1.0.CR1b

  JAVA: /Library/Java/Home/bin/java

  JAVA_OPTS: -Xms64m -Xmx512m -XX:MaxPermSize=256m -Djava.net.preferIPv4Stack=true -Dorg.jboss.resolver.warning=true -Dsun.rmi.dgc.client.gcInterval=3600000 -Dsun.rmi.dgc.server.gcInterval=3600000 -Djboss.modules.system.pkgs=org.jboss.byteman -Djava.awt.headless=true

=========================================================================
...

[Server:server-two] 16:59:55,870 INFO  [org.jboss.as] (Controller Boot Thread) JBoss AS 7.1.0.CR1b &quot;Flux Capacitor&quot; started in 2499ms - Started 148 of 214 services (64 services are passive or on-demand)</code></pre>
        </div>
    </div>
            <p>
    Now exit master and let's repeat the same steps on slave host. Finally we get WildFly 8 run on both master and slave, then we could move on to next step.            </p>
        </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-DomainConfiguration"  >
        <h3>Domain Configuration</h3>
    
    <div class="section-4"  id="66322833_HighAvailabilityGuide-Interfaceconfigonmaster"  >
        <h4>Interface config on master</h4>
    
            <p>
    In this section we'll setup both master and slave for them to run in domain mode. And we will configure master to be the domain controller.            </p>
                <p>
    First open the host.xml in master for editing:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>vi domain/configuration/host.xml</code></pre>
        </div>
    </div>
            <p>
    The default settings for interface in this file is like:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;interfaces&gt;
    &lt;interface name=&quot;management&quot;&gt;
        &lt;inet-address value=&quot;${jboss.bind.address.management:127.0.0.1}&quot;/&gt;
    &lt;/interface&gt;
    &lt;interface name=&quot;public&quot;&gt;
       &lt;inet-address value=&quot;${jboss.bind.address:127.0.0.1}&quot;/&gt;
    &lt;/interface&gt;
    &lt;interface name=&quot;unsecured&quot;&gt;      &nbsp;
       &lt;inet-address value=&quot;127.0.0.1&quot; /&gt;   &nbsp;
    &lt;/interface&gt;
&lt;/interfaces&gt;</code></pre>
        </div>
    </div>
            <p>
    We need to change the address to the management interface so slave could connect to master. The public interface allows the application to be accessed by non-local HTTP, and the unsecured interface allows remote RMI access. My master's ip address is 10.211.55.7, so I change the config to:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;interfaces&gt;
    &lt;interface name=&quot;management&quot;
        &lt;inet-address value=&quot;${jboss.bind.address.management:10.211.55.7}&quot;/&gt;
    &lt;/interface&gt;
    &lt;interface name=&quot;public&quot;&gt;
       &lt;inet-address value=&quot;${jboss.bind.address:10.211.55.7}&quot;/&gt;
    &lt;/interface&gt;   &nbsp;
    &lt;interface name=&quot;unsecured&quot;&gt;
       &lt;inet-address value=&quot;10.211.55.7&quot; /&gt;   &nbsp;
    &lt;/interface&gt;
&lt;/interfaces&gt;&nbsp;</code></pre>
        </div>
    </div>
    <div class="confbox programlisting">
                <div class="content">
        <pre><code></code></pre>
        </div>
    </div>
    </div>
    
    <div class="section-4"  id="66322833_HighAvailabilityGuide-Interfaceconfigonslave"  >
        <h4>Interface config on slave</h4>
    
            <p>
    Now we will setup interfaces on slave. First we need to remove the domain.xml from slave, because slave will not act as domain controller and it will under the management of master. I just rename the domain.xml so it won't be processed by WildFly:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>mv domain/configuration/domain.xml domain/configuration/domain.xml.move</code></pre>
        </div>
    </div>
    <div class="confbox admonition admonition-note">
        
            <p>
    From JBoss AS 7.1.Final you don't need to rename domain.xml anymore.            </p>
        </div>
    
            <p>
    Then let's edit host.xml. Similar to the steps on master, open host.xml first:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>vi domain/configuration/host.xml</code></pre>
        </div>
    </div>
            <p>
    The configuration we'll use on slave is a little bit different, because we need to let slave connect to master. First we need to set the hostname. We change the name property from:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;host name=&quot;master&quot; xmlns=&quot;urn:jboss:domain:1.1&quot;&gt;</code></pre>
        </div>
    </div>
            <p>
    to:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;host name=&quot;slave&quot; xmlns=&quot;urn:jboss:domain:1.1&quot;&gt;</code></pre>
        </div>
    </div>
            <p>
    Then we need to modify domain-controller section so slave can connect to master's management port:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;domain-controller&gt;
   &lt;remote host=&quot;10.211.55.7&quot; port=&quot;9999&quot;/&gt;
&lt;/domain-controller&gt;</code></pre>
        </div>
    </div>
            <p>
    As we know, 10.211.55.7 is the ip address of master.            </p>
                <p>
    Finally, we also need to configure interfaces section and expose the management ports to public address:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;interfaces&gt;
    &lt;interface name=&quot;management&quot;&gt;
        &lt;inet-address value=&quot;${jboss.bind.address.management:10.211.55.2}&quot;/&gt;
    &lt;/interface&gt;
    &lt;interface name=&quot;public&quot;&gt;
       &lt;inet-address value=&quot;${jboss.bind.address:10.211.55.2}&quot;/&gt;
    &lt;/interface&gt;
    &lt;interface name=&quot;unsecured&quot;&gt;      &nbsp;
       &lt;inet-address value=&quot;10.211.55.2&quot; /&gt;   &nbsp;
    &lt;/interface&gt;
&lt;/interfaces&gt;</code></pre>
        </div>
    </div>
            <p>
    10.211.55.2 is the ip address of the slave. Refer to the domain controller configuration above for an explanation of the management, public, and unsecured interfaces.            </p>
        <div class="confbox admonition admonition-note">
        
            <p>
    It is easier to turn off all firewalls for testing, but in production, you need to enable the firewall and allow access to the following ports: TBD            </p>
        </div>
    
    </div>
    
    <div class="section-4"  id="66322833_HighAvailabilityGuide-SecurityConfiguration"  >
        <h4>Security Configuration</h4>
    
            <p>
    If you start WildFly on both master and slave now, you will see the slave cannot be started with following error:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>[Host Controller] 20:31:24,575 ERROR [org.jboss.remoting.remote] (Remoting &quot;endpoint&quot; read-1) JBREM000200: Remote connection failed: javax.security.sasl.SaslException: Authentication failed: all available authentication mechanisms failed
[Host Controller] 20:31:24,579 WARN  [org.jboss.as.host.controller] (Controller Boot Thread) JBAS010900: Could not connect to remote domain controller 10.211.55.7:9999
[Host Controller] 20:31:24,582 ERROR [org.jboss.as.host.controller] (Controller Boot Thread) JBAS010901: Could not connect to master. Aborting. Error was: java.lang.IllegalStateException: JBAS010942: Unable to connect due to authentication failure.</code></pre>
        </div>
    </div>
            <p>
    Because we haven't properly set up the authentication between master and slave. Now let's work on it:            </p>
        <div class="section-5"  id="66322833_HighAvailabilityGuide-Master"  >
        <h5>Master</h5>
    
            <p>
    In bin directory there is a script called add-user.sh, we'll use it to add new users to the properties file used for domain management authentication:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>./add-user.sh

Enter the details of the new user to add.
Realm (ManagementRealm) :
Username : admin
Password : 123123
Re-enter Password : 123123
The username 'admin' is easy to guess
Are you sure you want to add user 'admin' yes/no? yes
About to add user 'admin' for realm 'ManagementRealm'
Is this correct yes/no? yes
Added user 'admin' to file '/home/weli/projs/jboss-as-7.1.0.CR1b/standalone/configuration/mgmt-users.properties'
Added user 'admin' to file '/home/weli/projs/jboss-as-7.1.0.CR1b/domain/configuration/mgmt-users.properties'</code></pre>
        </div>
    </div>
            <p>
    As shown above, we have created a user named 'admin' and its password is '123123'. Then we add another user called 'slave':            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>./add-user.sh

Enter the details of the new user to add.
Realm (ManagementRealm) :
Username : slave
Password : 123123
Re-enter Password : 123123
About to add user 'slave' for realm 'ManagementRealm'
Is this correct yes/no? yes
Added user 'slave' to file '/home/weli/projs/jboss-as-7.1.0.CR1b/standalone/configuration/mgmt-users.properties'
Added user 'slave' to file '/home/weli/projs/jboss-as-7.1.0.CR1b/domain/configuration/mgmt-users.properties'</code></pre>
        </div>
    </div>
            <p>
    We will use this user for slave host to connect to master.            </p>
        <div class="confbox admonition admonition-note">
        
            <p>
    Notice that the username must be equal to the name given in the slaves host element. That mean for each additional host you need a user.            </p>
        </div>
    
            <p>
    In newer version of WildFly, the add-user.sh will let you choose the type of the user. Here we need to choose 'Management User' type for both 'admin' and 'slave' account:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>./add-user.sh   What type of user do you wish to add?
 a) Management User (mgmt-users.properties)
 b) Application User (application-user.properties)
 (a):</code></pre>
        </div>
    </div>
    </div>
    
    <div class="section-5"  id="66322833_HighAvailabilityGuide-Slave"  >
        <h5>Slave</h5>
    
            <p>
    In slave we need to configure host.xml for authentication. We should change the security-realms section as following:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;security-realms&gt;
   &lt;security-realm name=&quot;ManagementRealm&quot;&gt;
       &lt;server-identities&gt;
           &lt;secret value=&quot;MTIzMTIz=&quot;/&gt;
       &lt;/server-identities&gt;
       &lt;authentication&gt;
           &lt;properties path=&quot;mgmt-users.properties&quot; relative-to=&quot;jboss.domain.config.dir&quot;/&gt;
       &lt;/authentication&gt;
   &lt;/security-realm&gt;
&lt;/security-realms&gt;</code></pre>
        </div>
    </div>
            <p>
    We've added server-identities into security-realm, which is used for authentication host when slave tries to connect to master. Because the slave's host name is set as 'slave', so we should use the 'slave' user's password on master. In secret value property we have 'MTIzMTIz=', which is the base64 code for '123123'. You can generate this value by using a base64 calculator such as the one at&nbsp;<a href="http://www.webutils.pl/index.php?idx=base64">http://www.webutils.pl/index.php?idx=base64</a>.            </p>
                <p>
    Then in domain controller section we also need to add security-realm property:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;domain-controller&gt;
   &lt;remote host=&quot;10.211.55.7&quot; port=&quot;9999&quot; security-realm=&quot;ManagementRealm&quot;/&gt;
&lt;/domain-controller&gt;</code></pre>
        </div>
    </div>
            <p>
    So the slave host could use the authentication information we provided in 'ManagementRealm'.            </p>
        </div>
    
    <div class="section-5"  id="66322833_HighAvailabilityGuide-DryRun"  >
        <h5>Dry Run</h5>
    
            <p>
    Now everything is set for the two hosts to run in domain mode. Let's start them by running domain.sh on both hosts. If everything goes fine, we could see from the log on master:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>[Host Controller] 21:30:52,042 INFO  [org.jboss.as.domain] (management-handler-threads - 1) JBAS010918: Registered remote slave host slave</code></pre>
        </div>
    </div>
            <p>
    That means all the configurations are correct and two hosts are run in domain mode now as expected.  Hurrah!            </p>
        </div>
    
    </div>
    
    </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-Deployment"  >
        <h3>Deployment</h3>
    
            <p>
    Now we can deploy a demo project into the domain. I have created a simple project located at:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>https://github.com/liweinan/cluster-demo</code></pre>
        </div>
    </div>
            <p>
    We can use git command to fetch a copy of the demo:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>git clone git://github.com/liweinan/cluster-demo.git</code></pre>
        </div>
    </div>
            <p>
    In this demo project we have a very simple web application. In web.xml we've enabled session replication by adding following entry:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;distributable/&gt;</code></pre>
        </div>
    </div>
            <p>
    And it contains a jsp page called put.jsp which will put current time to a session entry called 'current.time':            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;%
    session.setAttribute(&quot;current.time&quot;, new java.util.Date());
%&gt;</code></pre>
        </div>
    </div>
            <p>
    Then we could fetch this value from get.jsp:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>The time is &lt;%= session.getAttribute(&quot;current.time&quot;) %&gt;</code></pre>
        </div>
    </div>
            <p>
    It's an extremely simple project but it could help us to test the cluster later: We will access put.jsp from cluster and see the request are distributed to master, then we disconnect master and access get.jsp. We should see the request is forwarded to slave but the 'current.time' value is held by session replication. We'll cover more details on this one later.            </p>
                <p>
    Let's go back to this demo project. Now we need to create a war from it. In the project directory, run the following command to get the war:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>mvn package</code></pre>
        </div>
    </div>
            <p>
    It will generate cluster-demo.war. Then we need to deploy the war into domain. First we should access the http management console on master(Because master is acting as domain controller):            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>http://10.211.55.7:9990</code></pre>
        </div>
    </div>
            <p>
    It will popup a windows ask you to input account name and password, we can use the 'admin' account we've added just now. After logging in we could see the 'Server Instances' window. By default there are three servers listed, which are:            </p>
    <ul class="alternate "><li class=" ">            <p>
    server-one            </p>
    </li></ul><ul class="alternate "><li class=" ">            <p>
    server-two            </p>
    </li></ul><ul class="alternate "><li class=" ">            <p>
    server-three            </p>
    </li></ul>            <p>
    We could see server-one and server-two are in running status and they belong to main-server-group; server-three is in idle status, and it belongs to other-server-group.            </p>
                <p>
    All these servers and server groups are set in domain.xml on master as7. What we are interested in is the 'other-server-group' in domain.xml:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;server-group name=&quot;other-server-group&quot; profile=&quot;ha&quot;&gt;
   &lt;jvm name=&quot;default&quot;&gt;
       &lt;heap size=&quot;64m&quot; max-size=&quot;512m&quot;/&gt;
   &lt;/jvm&gt;
   &lt;socket-binding-group ref=&quot;ha-sockets&quot;/&gt;
&lt;/server-group&gt;</code></pre>
        </div>
    </div>
            <p>
    We could see this server-group is using 'ha' profile, which then uses 'ha-sockets' socket binding group. It enable all the modules we need to establish cluster later(including infinispan, jgroup and mod_cluster modules). So we will deploy our demo project into a server that belongs to 'other-server-group', so 'server-three' is our choice.            </p>
        <div class="confbox admonition admonition-note">
        
            <p>
    In newer version of WildFly, the profile 'ha' changes to 'full-ha':            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;server-group name=&quot;other-server-group&quot; profile=&quot;full-ha&quot;&gt;</code></pre>
        </div>
    </div>
    </div>
    
            <p>
    Let's go back to domain controller's management console:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>http://10.211.55.7:9990</code></pre>
        </div>
    </div>
            <p>
    Now server-three is not running, so let's click on 'server-three' and then click the 'start' button at bottom right of the server list. Wait a moment and server-three should start now.            </p>
                <p>
    Now we should also enable 'server-three' on slave: From the top of menu list on left side of the page, we could see now we are managing master currently. Click on the list, and click 'slave', then choose 'server-three', and we are in slave host management page now.            </p>
                <p>
    Then repeat the steps we've done on master to start 'server-three' on slave.            </p>
        <div class="confbox admonition admonition-note">
        
            <p>
    server-three on master and slave are two different hosts, their names can be different.            </p>
        </div>
    
            <p>
    After server-three on both master and slave are started, we will add our cluster-demo.war for deployment. Click on the 'Manage Deployments' link at the bottom of left menu list.            </p>
                <p>
        <img src="images/author/download/attachments/66322836/871748299.png" alt="images/author/download/attachments/66322836/871748299.png" />
    <br/>(We should ensure the server-three should be started on both master and slave)            </p>
                <p>
    After enter 'Manage Deployments' page, click 'Add Content' at top right corner. Then we should choose our cluster-demo.war, and follow the instruction to add it into our content repository.            </p>
                <p>
    Now we can see cluster-demo.war is added. Next we click 'Add to Groups' button and add the war to 'other-server-group' and then click 'save'.            </p>
                <p>
    Wait a few seconds, management console will tell you that the project is deployed into 'other-server-group'.&#65306;            </p>
                <p>
        <img src="images/author/download/attachments/66322836/231495614.png" alt="images/author/download/attachments/66322836/231495614.png" />
                </p>
                <p>
    Please note we have two hosts participate in this server group, so the project should be deployed in both master and slave now - that's the power of domain management.            </p>
                <p>
    Now let's verify this, trying to access cluster-demo from both master and slave, and they should all work now:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>http://10.211.55.7:8330/cluster-demo/</code></pre>
        </div>
    </div>
            <p>
        <img src="images/author/download/attachments/66322836/1222785376.png" alt="images/author/download/attachments/66322836/1222785376.png" />
                </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>http://10.211.55.2:8330/cluster-demo/</code></pre>
        </div>
    </div>
            <p>
        <img src="images/author/download/attachments/66322836/-1028060795.png" alt="images/author/download/attachments/66322836/-1028060795.png" />
                </p>
                <p>
    Now that we have finished the project deployment and see the usages of domain controller, we will then head up for using these two hosts to establish a cluster     <img src="images/author/images/icons/emoticons/109556488.gif" alt="images/author/images/icons/emoticons/109556488.gif" />
            </p>
        <div class="confbox admonition admonition-note">
        
            <p>
    Why the port number is 8330 instead of 8080? Please check the settings in host.xml on both master and slave:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;server name=&quot;server-three&quot; group=&quot;other-server-group&quot; auto-start=&quot;false&quot;&gt;
    &lt;!-- server-three avoids port conflicts by incrementing the ports in
         the default socket-group declared in the server-group --&gt;
    &lt;socket-bindings port-offset=&quot;250&quot;/&gt;
&lt;/server&gt;</code></pre>
        </div>
    </div>
            <p>
    The port-offset is set to 250, so 8080 + 250 = 8330            </p>
        </div>
    
            <p>
    Now we quit the WildFly process on both master and slave. We have some work left on host.xml configurations. Open the host.xml of master, and do some modifications the servers section from:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;server name=&quot;server-three&quot; group=&quot;other-server-group&quot; auto-start=&quot;false&quot;&gt;
    &lt;!-- server-three avoids port conflicts by incrementing the ports in
         the default socket-group declared in the server-group --&gt;
    &lt;socket-bindings port-offset=&quot;250&quot;/&gt;
&lt;/server&gt;</code></pre>
        </div>
    </div>
            <p>
    to:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;server name=&quot;server-three&quot; group=&quot;other-server-group&quot; auto-start=&quot;true&quot;&gt;
    &lt;!-- server-three avoids port conflicts by incrementing the ports in
         the default socket-group declared in the server-group --&gt;
    &lt;socket-bindings port-offset=&quot;250&quot;/&gt;
&lt;/server&gt;</code></pre>
        </div>
    </div>
            <p>
    We've set auto-start to true so we don't need to enable it in management console each time WildFly restart. Now open slave's host.xml, and modify the server-three section:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;server name=&quot;server-three-slave&quot; group=&quot;other-server-group&quot; auto-start=&quot;true&quot;&gt;
    &lt;!-- server-three avoids port conflicts by incrementing the ports in
         the default socket-group declared in the server-group --&gt;
    &lt;socket-bindings port-offset=&quot;250&quot;/&gt;
&lt;/server&gt;</code></pre>
        </div>
    </div>
            <p>
    Besides setting auto-start to true, we've renamed the 'server-three' to 'server-three-slave'. We need to do this because mod_cluster will fail to register the hosts with same name in a single server group. It will cause name conflict.            </p>
                <p>
    After finishing the above configuration, let's restart two as7 hosts and go on cluster configuration.            </p>
        </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-ClusterConfiguration"  >
        <h3>Cluster Configuration</h3>
    
            <p>
    We will use mod_cluster + apache httpd on master as our cluster controller here. Because WildFly 8 has been configured to support mod_cluster out of box so it's the easiest way.            </p>
        <div class="confbox admonition admonition-note">
        
            <p>
    The WildFly 8 domain controller and httpd are not necessary to be on same host. But in this article I just install them all on master for convenience.            </p>
        </div>
    
            <p>
    First we need to ensure that httpd is installed:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>sudo yum install httpd</code></pre>
        </div>
    </div>
            <p>
    And then we need to download newer version of mod_cluster from its website:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>http://www.jboss.org/mod_cluster/downloads</code></pre>
        </div>
    </div>
            <p>
    The version I downloaded is:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>http://downloads.jboss.org/mod_cluster/1.1.3.Final/mod_cluster-1.1.3.Final-linux2-x86-so.tar.gz</code></pre>
        </div>
    </div>
    <div class="confbox admonition admonition-note">
        
            <p>
    Jean-Frederic has suggested to use mod_cluster 1.2.x. Because 1.1.x it is affected by CVE-2011-4608            </p>
                <p>
    With mod_cluster-1.2.0 you need to add EnableMCPMReceive in the VirtualHost.            </p>
        </div>
    
            <p>
    Then we extract it into:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>/etc/httpd/modules</code></pre>
        </div>
    </div>
            <p>
    Then we edit httpd.conf:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>sudo vi /etc/httpd/conf/httpd.conf</code></pre>
        </div>
    </div>
            <p>
    We should add the modules:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>LoadModule slotmem_module modules/mod_slotmem.so
LoadModule manager_module modules/mod_manager.so
LoadModule proxy_cluster_module modules/mod_proxy_cluster.so
LoadModule advertise_module modules/mod_advertise.so</code></pre>
        </div>
    </div>
            <p>
    Please note we should comment out:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>#LoadModule proxy_balancer_module modules/mod_proxy_balancer.so</code></pre>
        </div>
    </div>
            <p>
    This is conflicted with cluster module. And then we need to make httpd to listen to public address so we could do the testing. Because we installed httpd on master host so we know the ip address of it:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>Listen 10.211.55.7:80</code></pre>
        </div>
    </div>
            <p>
    Then we do the necessary configuration at the bottom of httpd.conf:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code># This Listen port is for the mod_cluster-manager, where you can see the status of mod_cluster.
# Port 10001 is not a reserved port, so this prevents problems with SELinux.
Listen 10.211.55.7:10001
# This directive only applies to Red Hat Enterprise Linux. It prevents the temmporary
# files from being written to /etc/httpd/logs/ which is not an appropriate location.
MemManagerFile /var/cache/httpd

&lt;VirtualHost 10.211.55.7:10001&gt;

  &lt;Directory /&gt;
    Order deny,allow
    Deny from all
    Allow from 10.211.55.
  &lt;/Directory&gt;


  # This directive allows you to view mod_cluster status at URL http://10.211.55.4:10001/mod_cluster-manager
  &lt;Location /mod_cluster-manager&gt;
   SetHandler mod_cluster-manager
   Order deny,allow
   Deny from all
   Allow from 10.211.55.
  &lt;/Location&gt;

  KeepAliveTimeout 60
  MaxKeepAliveRequests 0

  ManagerBalancerName other-server-group
  AdvertiseFrequency 5

&lt;/VirtualHost&gt;</code></pre>
        </div>
    </div>
    <div class="confbox admonition admonition-note">
        
            <p>
    For more details on mod_cluster configurations please see this document:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>http://docs.jboss.org/mod_cluster/1.2.0/html/Quick_Start_Guide.html</code></pre>
        </div>
    </div>
    </div>
    
    </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-Testing"  >
        <h3>Testing</h3>
    
            <p>
    If everything goes fine we can start httpd service now:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>service httpd start</code></pre>
        </div>
    </div>
            <p>
    Now we access the cluster:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>http://10.211.55.7/cluster-demo/put.jsp</code></pre>
        </div>
    </div>
            <p>
        <img src="images/author/download/attachments/66322836/-553959633.png" alt="images/author/download/attachments/66322836/-553959633.png" />
                </p>
                <p>
    We should see the request is distributed to one of the hosts(master or slave) from the WildFly log. For me the request is sent to master:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>[Server:server-three] 16:06:22,256 INFO  [stdout] (http-10.211.55.7-10.211.55.7-8330-4) Putting date now</code></pre>
        </div>
    </div>
            <p>
    Now I disconnect master by using the management interface. Select 'runtime' and the server 'master' in the upper corners.            </p>
                <p>
    Select 'server-three' and kick the stop button, the active-icon should change.            </p>
                <p>
    Killing the server by using system commands will have the effect that the Host-Controller restart the instance imediately!            </p>
                <p>
    Then wait for a few seconds and access cluster:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>http://10.211.55.7/cluster-demo/get.jsp</code></pre>
        </div>
    </div>
            <p>
        <img src="images/author/download/attachments/66322836/-409624586.png" alt="images/author/download/attachments/66322836/-409624586.png" />
                </p>
                <p>
    Now the request should be served by slave and we should see the log from slave:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>[Server:server-three-slave] 16:08:29,860 INFO  [stdout] (http-10.211.55.2-10.211.55.2-8330-1) Getting date now</code></pre>
        </div>
    </div>
            <p>
    And from the get.jsp we should see that the time we get is the same we've put by 'put.jsp'. Thus it's proven that the session is correctly replicated to slave.            </p>
                <p>
    Now we restart master and should see the host is registered back to cluster.            </p>
        <div class="confbox admonition admonition-note">
        
            <p>
    It doesn't matter if you found the request is distributed to slave at first time. Then just disconnect slave and do the testing, the request should be sent to master instead. The point is we should see the request is redirect from one host to another and the session is held.            </p>
        </div>
    
    </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-SpecialThanks"  >
        <h3>Special Thanks</h3>
    
            <p>
    <a href="https://community.jboss.org/people/wdfink">Wolf-Dieter Fink</a> has contributed the updated add-user.sh usages and configs in host.xml from 7.1.0.Final.<br/><a href="https://community.jboss.org/people/jfclere">Jean-Frederic Clere</a> provided the mod_cluster 1.2.0 usages.<br/>Misty Stanley-Jones has given a lot of suggestions and helps to make this document readable.            </p>
        </div>
    
    </div>
    
    <div class="section-2"  id="66322833_HighAvailabilityGuide-WildFly8LBHAStandaloneClusterHowto"  >
        <h2>WildFly 8 LB HA Standalone Cluster Howto</h2>
    
<ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-PreparationandScenario">Preparation and Scenario</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Scenario">Scenario</a>            </p>
    </li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-DownloadWildFly8">Download WildFly 8</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-StartingWildflyinClusterConfiguration">Starting Wildfly in Cluster Configuration</a>            </p>
    </li></ul></li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Installing%26ConfiguringApacheHttpd">Installing &amp; Configuring Apache Httpd</a>            </p>
    <ul class=" "><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-DownloadApachehttpd">Download Apache httpd</a>            </p>
    </li><li class=" ">            <p>
    <a href="66322833.html#66322833_HighAvailabilityGuide-Configuration">Configuration</a>            </p>
    </li></ul></li></ul>            <p>
    In this article, I would like to document how to set up a load balanced high availability standalone cluster.            </p>
                <p>
    For domain cluster refer to&nbsp;<a href="66322836.html">WildFly 8 Cluster Howto</a>            </p>
        <div class="section-3"  id="66322833_HighAvailabilityGuide-PreparationandScenario"  >
        <h3>Preparation and Scenario</h3>
    
            <p>
    We need to prepare two hosts for this. We will assume that the following conditions are satisfied            </p>
    <ul class="alternate "><li class=" ">            <p>
    Two Nodes with *Nix installed            </p>
    </li><li class=" ">            <p>
    Make sure that they are in same local network            </p>
    </li><li class=" ">            <p>
    Make sure that they can access each other via different TCP/UDP ports(better turn off firewall and disable SELinux during the experiment or they will cause network problems).            </p>
    </li></ul>    <div class="section-4"  id="66322833_HighAvailabilityGuide-Scenario2"  >
        <h4>Scenario</h4>
    
<ul class="alternate "><li class=" ">            <p>
    We are going to install 2 standalone instances of WildFly - Let's call them Server One and Server Two            </p>
    </li><li class=" ">            <p>
    Both servers execute the full-ha profile            </p>
    </li><li class=" ">            <p>
    Apache httpd will be run on Server One and in httpd we will enable the mod_cluster module. The WildFly 8 on both the servers will form a cluster and discovered by httpd.            </p>
        <img src="images/author/download/attachments/84836504/-1907527039.png" alt="images/author/download/attachments/84836504/-1907527039.png" />
    </li></ul>    </div>
    
    </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-DownloadWildFly82"  >
        <h3>Download WildFly 8</h3>
    
            <p>
    First we should download WildFly 8 from the website:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>$ wget http://download.jboss.org/wildfly/8.1.0.Final/wildfly-8.1.0.Final.tar.gz</code></pre>
        </div>
    </div>
            <p>
    Next untar the downloaded zip            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code> mkdir ./wildfly;tar -xvf ~/wildfly-8.1.0.Final.tar.gz -C wildfly --strip-components=1</code></pre>
        </div>
    </div>
            <p>
    The above command will untar the package in to the wildfly directory            </p>
                <p>
    On changing to the wildfly directory and listing the directory structure, you should see the below structure            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>bash-4.1$ cd wildfly/
bash-4.1$ ls
appclient  bin  copyright.txt  docs  domain  jboss-modules.jar  LICENSE.txt  modules  README.txt  standalone  welcome-content</code></pre>
        </div>
    </div>
    <div class="section-4"  id="66322833_HighAvailabilityGuide-StartingWildflyinClusterConfiguration"  >
        <h4>Starting Wildfly in Cluster Configuration</h4>
    
            <p>
    Starting the wildfly instance can be done using the below command on Unix on both the servers            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>./standalone.sh -c standalone-ha.xml -b=$HOSTNAME -bmanagement=$HOSTNAME -u 230.0.0.4 -Djboss.node.name=$HOSTNAME</code></pre>
        </div>
    </div>
            <p>
    Here the -c option specifies the configuration file to use. We are going to use the High-Availability setup<br/>The -u option describes the multicast address. It is using this IP both servers communicate.<br/>For ease of setup, I have included the $HOSTNAME in the nodename and start up options            </p>
        <div class="confbox admonition admonition-note">
        
            <p>
    For windows User, replace the $HOSTNAME with %COMPUTERNAME%            </p>
        </div>
    
    <div class="confbox admonition admonition-note">
        
            <p>
    Please note that you should be in wildfy/bin when you execute the above command            </p>
        </div>
    
            <p>
    You should observer similar output            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>=========================================================================

  JBoss Bootstrap Environment

  JBOSS_HOME: /opt/app/wildfly

  JAVA: /opt/app/java/bin/java

  JAVA_OPTS:  -server -Xms64m -Xmx512m -XX:MaxPermSize=256m -Djava.net.preferIPv4Stack=true -Djboss.modules.system.pkgs=org.jboss.byteman -Djava.awt.headless=true

=========================================================================

15:00:42,515 INFO  [org.jboss.modules] (main) JBoss Modules version 1.3.3.Final
15:00:42,845 INFO  [org.jboss.msc] (main) JBoss MSC version 1.2.2.Final
15:00:42,943 INFO  [org.jboss.as] (MSC service thread 1-5) JBAS015899: WildFly 8.1.0.Final &quot;Kenny&quot; starting

......

15:00:47,028 INFO  [org.jboss.as.messaging] (MSC service thread 1-1) JBAS011601: Bound messaging object to jndi name java:jboss/DefaultJMSConnectionFactory
15:00:47,087 INFO  [org.jboss.as] (Controller Boot Thread) JBAS015961: Http management interface listening on http://135.101.232.143:9990/management
15:00:47,087 INFO  [org.jboss.as] (Controller Boot Thread) JBAS015951: Admin console listening on http://135.101.232.143:9990
15:00:47,088 INFO  [org.jboss.as] (Controller Boot Thread) JBAS015874: WildFly 8.1.0.Final &quot;Kenny&quot; started in 4954ms - Started 232 of 359 services (175 services are lazy, passive or on-demand)


</code></pre>
        </div>
    </div>
    </div>
    
    </div>
    
    </div>
    
    <div class="section-2"  id="66322833_HighAvailabilityGuide-Installing%26ConfiguringApacheHttpd"  >
        <h2>Installing &amp; Configuring Apache Httpd</h2>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-DownloadApachehttpd"  >
        <h3>Download Apache httpd</h3>
    
            <p>
    Get the httpd from the JBoss downlode site:            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>wget http://downloads.jboss.org/mod_cluster//1.2.6.Final/linux-x86_64/mod_cluster-1.2.6.Final-linux2-x64.tar.gz</code></pre>
        </div>
    </div>
            <p>
    This version is pre-configured with all set up necessary to run mod_cluster out of the box and connect with JBoss            </p>
                <p>
    If you already have HTTPD installed, then, please get the following archive and untar            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>wget http://downloads.jboss.org/mod_cluster//1.2.6.Final/linux-x86_64/mod_cluster-1.2.6.Final-linux2-x64-so.tar.gz</code></pre>
        </div>
    </div>
    <div class="confbox admonition admonition-warning">
        
            <p>
    The httpd and it's associated configuration assumes that the server will be installed in /opt/jboss/httpd.<br/>If you do not follow this path structure, then the configurations do not work.            </p>
                <p>
    On *nix, you can use the ln command to create a symbolic link to /opt/jboss/httpd and configure as needed            </p>
                <p>
    Sample as listed below            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code> /bin/ln &ndash;s /opt/app/myapp/httpd /opt/jboss/httpd </code></pre>
        </div>
    </div>
    </div>
    
    </div>
    
    <div class="section-3"  id="66322833_HighAvailabilityGuide-Configuration2"  >
        <h3>Configuration</h3>
    
            <p>
    The main configuration for the server would be under the     <div class="confbox programlisting">
                <div class="content">
        <pre><code>$SERVER_ROOT/httpd/httpd/conf</code></pre>
        </div>
    </div>
            </p>
                <p>
    Ensure the Listen directive is setup appropriately.            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>Listen 135.101.232.143:8081</code></pre>
        </div>
    </div>
            <p>
    At the end of the file ensure that the mod_cluster directive are appropriately setup            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>&lt;IfModule manager_module&gt;
  Listen 135.101.232.143:6666
  ManagerBalancerName mycluster
  &lt;VirtualHost 135.101.232.143:6666&gt;
    &lt;Location /&gt;
     Order allow,deny
     Deny from none
     Allow from 135.101.232.
    &lt;/Location&gt;

    KeepAliveTimeout 300
    MaxKeepAliveRequests 0
    #ServerAdvertise on http://@IP@:6666
    AdvertiseFrequency 5
    #AdvertiseSecurityKey secret
    #AdvertiseGroup @ADVIP@:23364
    EnableMCPMReceive

    &lt;Location /mod_cluster_manager&gt;
       SetHandler mod_cluster-manager
       Order allow,deny
       #Deny from all
       Allow from all
    &lt;/Location&gt;
&nbsp;ProxyPass / balancer://mycluster/


  &lt;/VirtualHost&gt;
&lt;/IfModule&gt;
</code></pre>
        </div>
    </div>
            <p>
    Save and exit.            </p>
                <p>
    Now, execute Apache via the following command            </p>
        <div class="confbox programlisting">
                <div class="content">
        <pre><code>/opt/app/jboss/httpd/sbin/apachectl -k start </code></pre>
        </div>
    </div>
            <p>
    Verify by opening the url: http://&lt;IP&gt;:6666/mod_cluster_manager in your browser            </p>
                <p>
    You should see something similar to this:            </p>
                <p>
        <img src="images/author/download/attachments/84836504/-58835523.png" alt="images/author/download/attachments/84836504/-58835523.png" />
                </p>
        </div>
    
    </div>
    
    <div class="section-2"  id="66322833_HighAvailabilityGuide-References"  >
        <h2>References</h2>
    
<div class=" error">            <p>
    Couldn't find a page to include called: <a href="https://docs.jboss.org/author/pages/createpage.action?spaceKey=WFLY8&amp;title=References&amp;linkCreation=true&amp;fromPageId=66322833">References</a>            </p>
    </div>    </div>
    
    <div class="section-2"  id="66322833_HighAvailabilityGuide-AllWildFly8documentation"  >
        <h2>All WildFly 8 documentation</h2>
    
            <p>
    There are several guides in the WildFly 8 documentation series. This list gives an overview of each of the guides:            </p>
                <p>
    *<a href="https://docs.jboss.org/author/display/WFLY8/Getting+Started+Guide">Getting Started Guide</a> - Explains how to download and start WildFly 8.<br/>*<a href="https://docs.jboss.org/author/display/WFLY8/Getting+Started+Developing+Applications+Guide">Getting Started Developing Applications Guide</a> - Talks you through developing your first applications on WildFly 8, and introduces you to JBoss Tools and how to deploy your applications.<br/>*<a href="https://docs.jboss.org/author/display/WFLY8/JavaEE+6+Tutorial">JavaEE 6 Tutorial</a> - A Java EE 6 Tutorial.<br/>*<a href="https://docs.jboss.org/author/display/WFLY8/Admin+Guide">Admin Guide</a> - Tells you how to configure and manage your WildFly 8 instances.<br/>*<a href="https://docs.jboss.org/author/display/WFLY8/Developer+Guide">Developer Guide</a> - Contains concepts that you need to be aware of when developing applications for WildFly 8. Classloading is explained in depth.<br/>*<a href="66322833.html">High Availability Guide</a> - Reference guide for how to set up clustered WildFly 8 instances.<br/>*<a href="https://docs.jboss.org/author/display/WFLY8/Extending+WildFly+8">Extending WildFly 8</a> - A guide to adding new functionality to WildFly 8.            </p>
        </div>
    
        </div>
    </div>
</body>
</html>
